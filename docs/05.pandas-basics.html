<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Python for Data Analysis, 3E - 5&nbsp; Getting Started with pandas</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./04.numpy-basics.html" rel="prev">
<link href="./cover.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01.preliminaries.html">Chapters</a></li><li class="breadcrumb-item"><a href="./05.pandas-basics.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Getting Started with pandas</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Python for Data Analysis, 3E</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/ZhengTiger/pydata-book-zh-cn" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Chapters</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01.preliminaries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Preliminaries</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02.python-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Python Language Basics, IPython, and Jupyter Notebooks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03.python-builtin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Built-In Data Structures, Functions, and Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04.numpy-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">NumPy Basics: Arrays and Vectorized Computation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05.pandas-basics.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Getting Started with pandas</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction-to-pandas-data-structures" id="toc-introduction-to-pandas-data-structures" class="nav-link active" data-scroll-target="#introduction-to-pandas-data-structures"><span class="header-section-number">5.1</span> Introduction to pandas Data Structures</a>
  <ul class="collapse">
  <li><a href="#series" id="toc-series" class="nav-link" data-scroll-target="#series"><span class="header-section-number">5.1.1</span> Series</a></li>
  <li><a href="#dataframe" id="toc-dataframe" class="nav-link" data-scroll-target="#dataframe"><span class="header-section-number">5.1.2</span> DataFrame</a></li>
  <li><a href="#index-objects" id="toc-index-objects" class="nav-link" data-scroll-target="#index-objects"><span class="header-section-number">5.1.3</span> Index Objects</a></li>
  </ul></li>
  <li><a href="#essential-functionality" id="toc-essential-functionality" class="nav-link" data-scroll-target="#essential-functionality"><span class="header-section-number">5.2</span> Essential Functionality</a>
  <ul class="collapse">
  <li><a href="#reindexing" id="toc-reindexing" class="nav-link" data-scroll-target="#reindexing"><span class="header-section-number">5.2.1</span> Reindexing</a></li>
  <li><a href="#dropping-entries-from-an-axis" id="toc-dropping-entries-from-an-axis" class="nav-link" data-scroll-target="#dropping-entries-from-an-axis"><span class="header-section-number">5.2.2</span> Dropping Entries from an Axis</a></li>
  <li><a href="#indexing-selection-and-filtering" id="toc-indexing-selection-and-filtering" class="nav-link" data-scroll-target="#indexing-selection-and-filtering"><span class="header-section-number">5.2.3</span> Indexing, Selection, and Filtering</a></li>
  <li><a href="#arithmetic-and-data-alignment" id="toc-arithmetic-and-data-alignment" class="nav-link" data-scroll-target="#arithmetic-and-data-alignment"><span class="header-section-number">5.2.4</span> Arithmetic and Data Alignment</a></li>
  <li><a href="#function-application-and-mapping" id="toc-function-application-and-mapping" class="nav-link" data-scroll-target="#function-application-and-mapping"><span class="header-section-number">5.2.5</span> Function Application and Mapping</a></li>
  <li><a href="#sorting-and-ranking" id="toc-sorting-and-ranking" class="nav-link" data-scroll-target="#sorting-and-ranking"><span class="header-section-number">5.2.6</span> Sorting and Ranking</a></li>
  <li><a href="#axis-indexes-with-duplicate-labels" id="toc-axis-indexes-with-duplicate-labels" class="nav-link" data-scroll-target="#axis-indexes-with-duplicate-labels"><span class="header-section-number">5.2.7</span> Axis Indexes with Duplicate Labels</a></li>
  </ul></li>
  <li><a href="#summarizing-and-computing-descriptive-statistics" id="toc-summarizing-and-computing-descriptive-statistics" class="nav-link" data-scroll-target="#summarizing-and-computing-descriptive-statistics"><span class="header-section-number">5.3</span> Summarizing and Computing Descriptive Statistics</a>
  <ul class="collapse">
  <li><a href="#correlation-and-covariance" id="toc-correlation-and-covariance" class="nav-link" data-scroll-target="#correlation-and-covariance"><span class="header-section-number">5.3.1</span> Correlation and Covariance</a></li>
  <li><a href="#unique-values-value-counts-and-membership" id="toc-unique-values-value-counts-and-membership" class="nav-link" data-scroll-target="#unique-values-value-counts-and-membership"><span class="header-section-number">5.3.2</span> Unique Values, Value Counts, and Membership</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">5.4</span> Conclusion</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/ZhengTiger/pydata-book-zh-cn/edit/main/05.pandas-basics.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/ZhengTiger/pydata-book-zh-cn/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01.preliminaries.html">Chapters</a></li><li class="breadcrumb-item"><a href="./05.pandas-basics.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Getting Started with pandas</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Getting Started with pandas</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>pandas 将成为本书其余大部分内容中令人感兴趣的主要工具。它包含数据结构和数据操作工具，旨在使 Python 中的数据清理和分析变得快速、方便。pandas 通常与 NumPy 和 SciPy 等数值计算工具、statsmodels 和 scikit-learn 等分析库以及 matplotlib 等数据可视化库配合使用。pandas 采用了 NumPy 的基于数组的计算惯用风格的重要部分，特别是基于数组的函数以及对不使用 <code>for</code> 循环的数据处理的偏好。</p>
<p>虽然 pandas 采用了 NumPy 的许多编码习惯，但最大的区别是 pandas 是为处理表格或异构数据而设计的。相比之下，NumPy 最适合处理同质类型的数值数组数据。</p>
<p>自 2010 年成为开源项目以来，pandas 已经发展成为一个相当大的库，适用于广泛的实际用例。开发者社区已发展到超过 2,500 名不同的贡献者，他们一直在帮助构建该项目，并使用该项目解决日常数据问题。充满活力的 pandas 开发者和用户社区是其成功的关键部分。</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>很多人不知道，自 2013 年以来，我就没有积极参与 pandas 的日常开发；从那时起，它就成为一个完全由社区管理的项目。请务必向核心开发人员和所有贡献者的辛勤工作表示感谢！</p>
</div>
</div>
<p>在本书的其余部分中，我对 NumPy 和 pandas 使用以下导入约定：</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">1</span>]: <span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">2</span>]: <span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>因此，每当你在代码中看到 <code>pd.</code>，它指的是 pandas。您可能还会发现将 Series 和 DataFrame 导入本地命名空间更容易，因为它们使用得非常频繁：</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">3</span>]: <span class="im">from</span> pandas <span class="im">import</span> Series, DataFrame</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="introduction-to-pandas-data-structures" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="introduction-to-pandas-data-structures"><span class="header-section-number">5.1</span> Introduction to pandas Data Structures</h2>
<p>要开始使用 pandas，您需要熟悉它的两种主力数据结构：<em>Series</em> 和 <em>DataFrame</em>。虽然它们并不是解决所有问题的通用解决方案，但它们为各种数据任务提供了坚实的基础。</p>
<section id="series" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="series"><span class="header-section-number">5.1.1</span> Series</h3>
<p>Series 是一个类似一维数组的对象，包含相同类型的值序列（与 NumPy 类型类似）和关联的数据标签数组（称为 <em>index</em>）。最简单的 Series 仅由数据数组组成：</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">14</span>]: obj <span class="op">=</span> pd.Series([<span class="dv">4</span>, <span class="dv">7</span>, <span class="op">-</span><span class="dv">5</span>, <span class="dv">3</span>])</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">15</span>]: obj</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">15</span>]: </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="dv">4</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="dv">7</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   <span class="op">-</span><span class="dv">5</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="dv">3</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>以交互方式显示的 Series 的字符串表示形式在左侧显示 index，在右侧显示值。由于我们没有为数据指定 index，因此会创建一个由整数 <code>0</code> 到 <code>N - 1</code>（其中 <code>N</code> 是数据的长度）组成的默认索引。您可以分别通过其 <code>array</code> 和 <code>index</code> 属性获取 Series 的 array 表示形式和 index 对象：</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">16</span>]: obj.array</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">16</span>]: </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>PandasArray<span class="op">&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">4</span>, <span class="dv">7</span>, <span class="op">-</span><span class="dv">5</span>, <span class="dv">3</span>]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>Length: <span class="dv">4</span>, dtype: int64</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">17</span>]: obj.index</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">17</span>]: RangeIndex(start<span class="op">=</span><span class="dv">0</span>, stop<span class="op">=</span><span class="dv">4</span>, step<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>.array</code> 属性的结果是一个 <code>PandasArray</code>，它通常包装一个 NumPy 数组，但也可以包含特殊的扩展数组类型，这将在 <a href="https://wesmckinney.com/book/data-cleaning#pandas-ext-types">Ch 7.3: Extension Data Types</a> 中详细讨论。</p>
<p>通常，您需要创建一个带有 index 的 Series，该 index 用标签标识每个数据点：</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">18</span>]: obj2 <span class="op">=</span> pd.Series([<span class="dv">4</span>, <span class="dv">7</span>, <span class="op">-</span><span class="dv">5</span>, <span class="dv">3</span>], index<span class="op">=</span>[<span class="st">"d"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"c"</span>])</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">19</span>]: obj2</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">19</span>]: </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>d    <span class="dv">4</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">7</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>a   <span class="op">-</span><span class="dv">5</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>c    <span class="dv">3</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>dtype: int64</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">20</span>]: obj2.index</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">20</span>]: Index([<span class="st">'d'</span>, <span class="st">'b'</span>, <span class="st">'a'</span>, <span class="st">'c'</span>], dtype<span class="op">=</span><span class="st">'object'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>与 NumPy 数组相比，在选择单个值或一组值时可以在 index 中使用标签：</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">21</span>]: obj2[<span class="st">"a"</span>]</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">21</span>]: <span class="op">-</span><span class="dv">5</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">22</span>]: obj2[<span class="st">"d"</span>] <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">23</span>]: obj2[[<span class="st">"c"</span>, <span class="st">"a"</span>, <span class="st">"d"</span>]]</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">23</span>]: </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>c    <span class="dv">3</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>a   <span class="op">-</span><span class="dv">5</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>d    <span class="dv">6</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>这里 <code>["c", "a", "d"]</code> 被解释为索引列表，即使它包含字符串而不是整数。</p>
<p>使用 NumPy 函数或类似 NumPy 的操作（例如使用布尔数组进行过滤、标量乘法或应用数学函数）将保留索引值链接：</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">24</span>]: obj2[obj2 <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">24</span>]: </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>d    <span class="dv">6</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">7</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>c    <span class="dv">3</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>dtype: int64</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">25</span>]: obj2 <span class="op">*</span> <span class="dv">2</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">25</span>]: </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>d    <span class="dv">12</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">14</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>a   <span class="op">-</span><span class="dv">10</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>c     <span class="dv">6</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>dtype: int64</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">26</span>]: <span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">27</span>]: np.exp(obj2)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">27</span>]: </span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>d     <span class="fl">403.428793</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>b    <span class="fl">1096.633158</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>a       <span class="fl">0.006738</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>c      <span class="fl">20.085537</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>将 Series 视为固定长度的有序字典的另一种方式，因为它是索引值到数据值的映射。它可以在许多可能使用字典的情况下使用：</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">28</span>]: <span class="st">"b"</span> <span class="kw">in</span> obj2</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">28</span>]: <span class="va">True</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">29</span>]: <span class="st">"e"</span> <span class="kw">in</span> obj2</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">29</span>]: <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>如果 Python 字典中包含数据，则可以通过传递字典来创建 Series：</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">30</span>]: sdata <span class="op">=</span> {<span class="st">"Ohio"</span>: <span class="dv">35000</span>, <span class="st">"Texas"</span>: <span class="dv">71000</span>, <span class="st">"Oregon"</span>: <span class="dv">16000</span>, <span class="st">"Utah"</span>: <span class="dv">5000</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">31</span>]: obj3 <span class="op">=</span> pd.Series(sdata)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">32</span>]: obj3</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">32</span>]: </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>Ohio      <span class="dv">35000</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>Texas     <span class="dv">71000</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>Oregon    <span class="dv">16000</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>Utah       <span class="dv">5000</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Series 可以使用其 <code>to_dict</code> 方法转换回字典：</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">33</span>]: obj3.to_dict()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">33</span>]: {<span class="st">'Ohio'</span>: <span class="dv">35000</span>, <span class="st">'Texas'</span>: <span class="dv">71000</span>, <span class="st">'Oregon'</span>: <span class="dv">16000</span>, <span class="st">'Utah'</span>: <span class="dv">5000</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>当您仅传递字典时，结果 Series 中的索引将根据字典的键方法遵循键的顺序，这取决于键插入顺序。您可以通过传递带有字典键的索引来覆盖它，按照您希望它们在结果系列中出现的顺序：</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">34</span>]: states <span class="op">=</span> [<span class="st">"California"</span>, <span class="st">"Ohio"</span>, <span class="st">"Oregon"</span>, <span class="st">"Texas"</span>]</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">35</span>]: obj4 <span class="op">=</span> pd.Series(sdata, index<span class="op">=</span>states)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">36</span>]: obj4</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">36</span>]: </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>California        NaN</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>Ohio          <span class="fl">35000.0</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>Oregon        <span class="fl">16000.0</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>Texas         <span class="fl">71000.0</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>在这里，在 <code>sdata</code> 中找到的三个值被放置在适当的位置，但由于没有找到 <code>"California"</code> 的值，因此它显示为 <code>NaN</code>（Not a Number），这在 pandas 中被视为标记缺失或 <code>NA</code> 值。由于 <code>"Utah"</code> 未包含在 <code>states</code> 中，因此它被排除在结果对象之外。</p>
<p>我将交替使用术语 “missing”、“NA” 或 “null” 来指代缺失的数据。pandas 中的 <code>isna</code> 和 <code>notna</code> 函数应该用于检测丢失的数据：</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">37</span>]: pd.isna(obj4)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">37</span>]: </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>California     <span class="va">True</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>Ohio          <span class="va">False</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>Oregon        <span class="va">False</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>Texas         <span class="va">False</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">bool</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">38</span>]: pd.notna(obj4)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">38</span>]: </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>California    <span class="va">False</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>Ohio           <span class="va">True</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>Oregon         <span class="va">True</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>Texas          <span class="va">True</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">bool</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Series 还有这些实例方法：</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">39</span>]: obj4.isna()</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">39</span>]: </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>California     <span class="va">True</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>Ohio          <span class="va">False</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>Oregon        <span class="va">False</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>Texas         <span class="va">False</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">bool</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>我在 <a href="https://wesmckinney.com/book/data-cleaning">Ch 7: Data Cleaning and Preparation</a> 中更详细地讨论了如何处理丢失的数据。</p>
<p>对于许多应用程序来说，一个有用的 Series 功能是它在算术运算中按索引标签自动对齐：</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">40</span>]: obj3</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">40</span>]: </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>Ohio      <span class="dv">35000</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>Texas     <span class="dv">71000</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>Oregon    <span class="dv">16000</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>Utah       <span class="dv">5000</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>dtype: int64</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">41</span>]: obj4</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">41</span>]: </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>California        NaN</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>Ohio          <span class="fl">35000.0</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>Oregon        <span class="fl">16000.0</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>Texas         <span class="fl">71000.0</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>dtype: float64</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">42</span>]: obj3 <span class="op">+</span> obj4</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">42</span>]: </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>California         NaN</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>Ohio           <span class="fl">70000.0</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>Oregon         <span class="fl">32000.0</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>Texas         <span class="fl">142000.0</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>Utah               NaN</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>稍后将更详细地讨论数据对齐功能。如果您有数据库方面的经验，您可以将其视为类似于连接操作。</p>
<p>Series 对象本身及其索引都有一个 <code>name</code> 属性，它与 pandas 功能的其他区域集成：</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">43</span>]: obj4.name <span class="op">=</span> <span class="st">"population"</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">44</span>]: obj4.index.name <span class="op">=</span> <span class="st">"state"</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">45</span>]: obj4</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">45</span>]: </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>state</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>California        NaN</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>Ohio          <span class="fl">35000.0</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>Oregon        <span class="fl">16000.0</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>Texas         <span class="fl">71000.0</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>Name: population, dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Series 的索引可以通过赋值来改变：</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">46</span>]: obj</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">46</span>]: </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="dv">4</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="dv">7</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   <span class="op">-</span><span class="dv">5</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="dv">3</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>dtype: int64</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">47</span>]: obj.index <span class="op">=</span> [<span class="st">"Bob"</span>, <span class="st">"Steve"</span>, <span class="st">"Jeff"</span>, <span class="st">"Ryan"</span>]</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">48</span>]: obj</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">48</span>]: </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>Bob      <span class="dv">4</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>Steve    <span class="dv">7</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>Jeff    <span class="op">-</span><span class="dv">5</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>Ryan     <span class="dv">3</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="dataframe" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="dataframe"><span class="header-section-number">5.1.2</span> DataFrame</h3>
<p>DataFrame 表示一个矩形数据表，并包含有序的、命名的列集合，每个列可以是不同的值类型（数字、字符串、布尔值等）。DataFrame 同时具有行索引和列索引；它可以被认为是共享相同索引的 Series 的字典。</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>虽然 DataFrame 物理上是二维的，但您可以使用分层索引以表格格式表示更高维的数据，我们将在 <a href="https://wesmckinney.com/book/data-wrangling">Ch 8: Data Wrangling: Join, Combine, and Reshape</a> 中讨论该主题，也是某些 pandas 中更高级的数据处理功能。</p>
</div>
</div>
<p>构造 DataFrame 的方法有很多，最常见的方法之一是使用等长列表或 NumPy 数组的字典：</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> {<span class="st">"state"</span>: [<span class="st">"Ohio"</span>, <span class="st">"Ohio"</span>, <span class="st">"Ohio"</span>, <span class="st">"Nevada"</span>, <span class="st">"Nevada"</span>, <span class="st">"Nevada"</span>],</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>        <span class="st">"year"</span>: [<span class="dv">2000</span>, <span class="dv">2001</span>, <span class="dv">2002</span>, <span class="dv">2001</span>, <span class="dv">2002</span>, <span class="dv">2003</span>],</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"pop"</span>: [<span class="fl">1.5</span>, <span class="fl">1.7</span>, <span class="fl">3.6</span>, <span class="fl">2.4</span>, <span class="fl">2.9</span>, <span class="fl">3.2</span>]}</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>frame <span class="op">=</span> pd.DataFrame(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>与 Series 一样，生成的 DataFrame 将自动分配其索引，并且列根据数据中键的顺序放置（这取决于它们在字典中的插入顺序）：</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">50</span>]: frame</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">50</span>]: </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    state  year  pop</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    Ohio  <span class="dv">2000</span>  <span class="fl">1.5</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    Ohio  <span class="dv">2001</span>  <span class="fl">1.7</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    Ohio  <span class="dv">2002</span>  <span class="fl">3.6</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  Nevada  <span class="dv">2001</span>  <span class="fl">2.4</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  Nevada  <span class="dv">2002</span>  <span class="fl">2.9</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  Nevada  <span class="dv">2003</span>  <span class="fl">3.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>如果您使用的是 Jupyter notebook，pandas DataFrame 对象将显示为对浏览器更友好的 HTML 表格。有关示例，请参见 <a href="https://wesmckinney.com/book/pandas-basics#fig-figure_pandas_df_html_table">Figure 5.1</a>。</p>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://wesmckinney.com/book/images/pda3_0501.png" class="img-fluid figure-img"></p>
<figcaption>Figure 5.1: How pandas DataFrame objects look in Jupyter</figcaption>
</figure>
</div>
<p>对于大型 DataFrame，<code>head</code> 方法仅选择前五行：</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">51</span>]: frame.head()</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">51</span>]: </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    state  year  pop</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    Ohio  <span class="dv">2000</span>  <span class="fl">1.5</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    Ohio  <span class="dv">2001</span>  <span class="fl">1.7</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    Ohio  <span class="dv">2002</span>  <span class="fl">3.6</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  Nevada  <span class="dv">2001</span>  <span class="fl">2.4</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  Nevada  <span class="dv">2002</span>  <span class="fl">2.9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>同样，<code>tail</code> 返回最后五行：</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">52</span>]: frame.tail()</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">52</span>]: </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    state  year  pop</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    Ohio  <span class="dv">2001</span>  <span class="fl">1.7</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    Ohio  <span class="dv">2002</span>  <span class="fl">3.6</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  Nevada  <span class="dv">2001</span>  <span class="fl">2.4</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  Nevada  <span class="dv">2002</span>  <span class="fl">2.9</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  Nevada  <span class="dv">2003</span>  <span class="fl">3.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>如果指定列序列，DataFrame 的列将按该顺序排列：</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">53</span>]: pd.DataFrame(data, columns<span class="op">=</span>[<span class="st">"year"</span>, <span class="st">"state"</span>, <span class="st">"pop"</span>])</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">53</span>]: </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>   year   state  pop</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="dv">2000</span>    Ohio  <span class="fl">1.5</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="dv">2001</span>    Ohio  <span class="fl">1.7</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="dv">2002</span>    Ohio  <span class="fl">3.6</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="dv">2001</span>  Nevada  <span class="fl">2.4</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="dv">2002</span>  Nevada  <span class="fl">2.9</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  <span class="dv">2003</span>  Nevada  <span class="fl">3.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>如果您传递字典中未包含的列，则结果中将显示缺失值：</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">54</span>]: frame2 <span class="op">=</span> pd.DataFrame(data, columns<span class="op">=</span>[<span class="st">"year"</span>, <span class="st">"state"</span>, <span class="st">"pop"</span>, <span class="st">"debt"</span>])</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">55</span>]: frame2</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">55</span>]: </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>   year   state  pop debt</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="dv">2000</span>    Ohio  <span class="fl">1.5</span>  NaN</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="dv">2001</span>    Ohio  <span class="fl">1.7</span>  NaN</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="dv">2002</span>    Ohio  <span class="fl">3.6</span>  NaN</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="dv">2001</span>  Nevada  <span class="fl">2.4</span>  NaN</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="dv">2002</span>  Nevada  <span class="fl">2.9</span>  NaN</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  <span class="dv">2003</span>  Nevada  <span class="fl">3.2</span>  NaN</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">56</span>]: frame2.columns</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">56</span>]: Index([<span class="st">'year'</span>, <span class="st">'state'</span>, <span class="st">'pop'</span>, <span class="st">'debt'</span>], dtype<span class="op">=</span><span class="st">'object'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>DataFrame 中的列可以通过类似字典的表示法或使用点属性表示法作为 Series 进行检索：</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">57</span>]: frame2[<span class="st">"state"</span>]</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">57</span>]: </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>      Ohio</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>      Ohio</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>      Ohio</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    Nevada</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    Nevada</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    Nevada</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>Name: state, dtype: <span class="bu">object</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">58</span>]: frame2.year</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">58</span>]: </span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="dv">2000</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="dv">2001</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="dv">2002</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="dv">2001</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    <span class="dv">2002</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    <span class="dv">2003</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>Name: year, dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>为了方便起见，IPython 中提供了类似属性的访问（例如，<code>frame2.year</code>）和制表符完成列名称。</p>
<p><code>frame2[column]</code> 适用于任何列名称，但 <code>frame2.column</code> 仅当列名称是有效的 Python 变量名称并且不与 DataFrame 中的任何方法名称冲突时才有效。例如，如果列的名称包含空格或下划线以外的符号，则无法使用点属性方法访问它。</p>
</div>
</div>
<p>请注意，返回的 Series 与 DataFrame 具有相同的索引，并且它们的 <code>name</code> 属性已适当设置。</p>
<p>还可以使用特殊的 <code>iloc</code> 和 <code>loc</code> 属性按位置或名称检索行（稍后将在 <a href="https://wesmckinney.com/book/pandas-basics#pandas-loc-iloc">Selection on DataFrame with loc and iloc</a> 中详细介绍）：</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">59</span>]: frame2.loc[<span class="dv">1</span>]</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">59</span>]: </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>year     <span class="dv">2001</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>state    Ohio</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>pop       <span class="fl">1.7</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>debt      NaN</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>Name: <span class="dv">1</span>, dtype: <span class="bu">object</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">60</span>]: frame2.iloc[<span class="dv">2</span>]</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">60</span>]: </span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>year     <span class="dv">2002</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>state    Ohio</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>pop       <span class="fl">3.6</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>debt      NaN</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>Name: <span class="dv">2</span>, dtype: <span class="bu">object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>可以通过分配来修改列。例如，可以为空 <code>debt</code> 列分配标量值或值数组：</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">61</span>]: frame2[<span class="st">"debt"</span>] <span class="op">=</span> <span class="fl">16.5</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">62</span>]: frame2</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">62</span>]: </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>   year   state  pop  debt</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="dv">2000</span>    Ohio  <span class="fl">1.5</span>  <span class="fl">16.5</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="dv">2001</span>    Ohio  <span class="fl">1.7</span>  <span class="fl">16.5</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="dv">2002</span>    Ohio  <span class="fl">3.6</span>  <span class="fl">16.5</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="dv">2001</span>  Nevada  <span class="fl">2.4</span>  <span class="fl">16.5</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="dv">2002</span>  Nevada  <span class="fl">2.9</span>  <span class="fl">16.5</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  <span class="dv">2003</span>  Nevada  <span class="fl">3.2</span>  <span class="fl">16.5</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">63</span>]: frame2[<span class="st">"debt"</span>] <span class="op">=</span> np.arange(<span class="fl">6.</span>)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">64</span>]: frame2</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">64</span>]: </span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>   year   state  pop  debt</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="dv">2000</span>    Ohio  <span class="fl">1.5</span>   <span class="fl">0.0</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="dv">2001</span>    Ohio  <span class="fl">1.7</span>   <span class="fl">1.0</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="dv">2002</span>    Ohio  <span class="fl">3.6</span>   <span class="fl">2.0</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="dv">2001</span>  Nevada  <span class="fl">2.4</span>   <span class="fl">3.0</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="dv">2002</span>  Nevada  <span class="fl">2.9</span>   <span class="fl">4.0</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  <span class="dv">2003</span>  Nevada  <span class="fl">3.2</span>   <span class="fl">5.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>将列表或数组分配给列时，值的长度必须与 DataFrame 的长度匹配。如果您分配一个 Series，它的标签将完全与 DataFrame 的索引重新对齐，在任何不存在的索引值中插入缺失值：</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">65</span>]: val <span class="op">=</span> pd.Series([<span class="op">-</span><span class="fl">1.2</span>, <span class="op">-</span><span class="fl">1.5</span>, <span class="op">-</span><span class="fl">1.7</span>], index<span class="op">=</span>[<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">66</span>]: frame2[<span class="st">"debt"</span>] <span class="op">=</span> val</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">67</span>]: frame2</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">67</span>]: </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>   year   state  pop  debt</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="dv">2000</span>    Ohio  <span class="fl">1.5</span>   NaN</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="dv">2001</span>    Ohio  <span class="fl">1.7</span>   NaN</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="dv">2002</span>    Ohio  <span class="fl">3.6</span>  <span class="op">-</span><span class="fl">1.2</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="dv">2001</span>  Nevada  <span class="fl">2.4</span>   NaN</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="dv">2002</span>  Nevada  <span class="fl">2.9</span>  <span class="op">-</span><span class="fl">1.5</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  <span class="dv">2003</span>  Nevada  <span class="fl">3.2</span>  <span class="op">-</span><span class="fl">1.7</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>分配不存在的列将创建一个新列。</p>
<p><code>del</code> 关键字将像字典一样删除列。作为示例，我首先添加一个新的布尔值列，其中 <code>state</code> 列等于 <code>"Ohio"</code>：</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">68</span>]: frame2[<span class="st">"eastern"</span>] <span class="op">=</span> frame2[<span class="st">"state"</span>] <span class="op">==</span> <span class="st">"Ohio"</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">69</span>]: frame2</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">69</span>]: </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>   year   state  pop  debt  eastern</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="dv">2000</span>    Ohio  <span class="fl">1.5</span>   NaN     <span class="va">True</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="dv">2001</span>    Ohio  <span class="fl">1.7</span>   NaN     <span class="va">True</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="dv">2002</span>    Ohio  <span class="fl">3.6</span>  <span class="op">-</span><span class="fl">1.2</span>     <span class="va">True</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="dv">2001</span>  Nevada  <span class="fl">2.4</span>   NaN    <span class="va">False</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="dv">2002</span>  Nevada  <span class="fl">2.9</span>  <span class="op">-</span><span class="fl">1.5</span>    <span class="va">False</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  <span class="dv">2003</span>  Nevada  <span class="fl">3.2</span>  <span class="op">-</span><span class="fl">1.7</span>    <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>无法使用 <code>frame2.eastern</code> 点属性表示法创建新列。</p>
</div>
</div>
<p>然后可以使用 <code>del</code> 方法删除该列：</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">70</span>]: <span class="kw">del</span> frame2[<span class="st">"eastern"</span>]</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">71</span>]: frame2.columns</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">71</span>]: Index([<span class="st">'year'</span>, <span class="st">'state'</span>, <span class="st">'pop'</span>, <span class="st">'debt'</span>], dtype<span class="op">=</span><span class="st">'object'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>对 DataFrame 进行索引返回的列是基础数据的视图，而不是副本。因此，对 Series 的任何就地修改都将反映在 DataFrame 中。可以使用 Series 的 <code>copy</code> 方法显式复制该列。</p>
</div>
</div>
<p>另一种常见的数据形式是字典的嵌套字典：</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">72</span>]: populations <span class="op">=</span> {<span class="st">"Ohio"</span>: {<span class="dv">2000</span>: <span class="fl">1.5</span>, <span class="dv">2001</span>: <span class="fl">1.7</span>, <span class="dv">2002</span>: <span class="fl">3.6</span>},</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>   ....:                <span class="st">"Nevada"</span>: {<span class="dv">2001</span>: <span class="fl">2.4</span>, <span class="dv">2002</span>: <span class="fl">2.9</span>}}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>如果嵌套字典传递给 DataFrame，pandas 会将外部字典键解释为列，将内部键解释为行索引：</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">73</span>]: frame3 <span class="op">=</span> pd.DataFrame(populations)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">74</span>]: frame3</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">74</span>]: </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>      Ohio  Nevada</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2000</span>   <span class="fl">1.5</span>     NaN</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2001</span>   <span class="fl">1.7</span>     <span class="fl">2.4</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2002</span>   <span class="fl">3.6</span>     <span class="fl">2.9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>您可以使用与 NumPy 数组类似的语法转置 DataFrame（交换行和列）：</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">75</span>]: frame3.T</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">75</span>]: </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>        <span class="dv">2000</span>  <span class="dv">2001</span>  <span class="dv">2002</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>Ohio     <span class="fl">1.5</span>   <span class="fl">1.7</span>   <span class="fl">3.6</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>Nevada   NaN   <span class="fl">2.4</span>   <span class="fl">2.9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>请注意，如果列不全部具有相同的数据类型，转置会丢弃列数据类型，因此转置然后转回可能会丢失以前的类型信息。在这种情况下，列变成纯 Python 对象的数组。</p>
</div>
</div>
<p>内部字典中的键组合起来形成结果中的索引。如果指定了显式索引，则情况并非如此：</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">76</span>]: pd.DataFrame(populations, index<span class="op">=</span>[<span class="dv">2001</span>, <span class="dv">2002</span>, <span class="dv">2003</span>])</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">76</span>]: </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>      Ohio  Nevada</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2001</span>   <span class="fl">1.7</span>     <span class="fl">2.4</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2002</span>   <span class="fl">3.6</span>     <span class="fl">2.9</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2003</span>   NaN     NaN</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Series 字典的处理方式大致相同：</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">77</span>]: pdata <span class="op">=</span> {<span class="st">"Ohio"</span>: frame3[<span class="st">"Ohio"</span>][:<span class="op">-</span><span class="dv">1</span>],</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>   ....:          <span class="st">"Nevada"</span>: frame3[<span class="st">"Nevada"</span>][:<span class="dv">2</span>]}</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">78</span>]: pd.DataFrame(pdata)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">78</span>]: </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>      Ohio  Nevada</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2000</span>   <span class="fl">1.5</span>     NaN</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2001</span>   <span class="fl">1.7</span>     <span class="fl">2.4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>有关可以传递给 DataFrame 构造函数的许多内容的列表，请参阅 <a href="https://wesmckinney.com/book/pandas-basics#tbl-table_dataframe_constructor">Table 5.1</a>。</p>
<table class="table">
<caption>Table 5.1: Possible data inputs to the DataFrame constructor</caption>
<colgroup>
<col style="width: 62%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2D ndarray</td>
<td style="text-align: left;">数据矩阵，传递可选的行和列标签</td>
</tr>
<tr class="even">
<td style="text-align: left;">Dictionary of arrays, lists, or tuples</td>
<td style="text-align: left;">每个序列成为 DataFrame 中的一列；所有序列的长度必须相同</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NumPy structured/record array</td>
<td style="text-align: left;">被视为 “dictionary of arrays” 的情况</td>
</tr>
<tr class="even">
<td style="text-align: left;">Dictionary of Series</td>
<td style="text-align: left;">每个值成为一列；如果没有传递显式索引，则每个 Series 的索引将联合在一起形成结果的行索引</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dictionary of dictionaries</td>
<td style="text-align: left;">每个内部字典成为一列；键被联合起来形成行索引，如 “dictionary of Series” 的情况</td>
</tr>
<tr class="even">
<td style="text-align: left;">List of dictionaries or Series</td>
<td style="text-align: left;">每个项目都成为 DataFrame 中的一行；字典键或 Series 索引的并集成为 DataFrame 的列标签</td>
</tr>
<tr class="odd">
<td style="text-align: left;">List of lists or tuples</td>
<td style="text-align: left;">被视为 “2D ndarray” 情况</td>
</tr>
<tr class="even">
<td style="text-align: left;">Another DataFrame</td>
<td style="text-align: left;">除非传递不同的索引，否则将使用 DataFrame 的索引</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NumPy MaskedArray</td>
<td style="text-align: left;">与 “2D ndarray” 情况类似，只是 DataFrame 结果中缺少屏蔽值</td>
</tr>
</tbody>
</table>
<p>如果 DataFrame 的 <code>index</code> 和 <code>columns</code> 设置了 <code>name</code> 属性，这些属性也会显示：</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">79</span>]: frame3.index.name <span class="op">=</span> <span class="st">"year"</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">80</span>]: frame3.columns.name <span class="op">=</span> <span class="st">"state"</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">81</span>]: frame3</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">81</span>]: </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>state  Ohio  Nevada</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>year               </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="dv">2000</span>    <span class="fl">1.5</span>     NaN</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="dv">2001</span>    <span class="fl">1.7</span>     <span class="fl">2.4</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="dv">2002</span>    <span class="fl">3.6</span>     <span class="fl">2.9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>与 Series 不同，DataFrame 没有 <code>name</code> 属性。DataFrame 的 <code>to_numpy</code> 方法将 DataFrame 中包含的数据作为二维 ndarray 返回：</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">82</span>]: frame3.to_numpy()</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">82</span>]: </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>array([[<span class="fl">1.5</span>, nan],</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>       [<span class="fl">1.7</span>, <span class="fl">2.4</span>],</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>       [<span class="fl">3.6</span>, <span class="fl">2.9</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>如果 DataFrame 的列是不同的数据类型，则将选择返回数组的数据类型来容纳所有列：</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">83</span>]: frame2.to_numpy()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">83</span>]: </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>array([[<span class="dv">2000</span>, <span class="st">'Ohio'</span>, <span class="fl">1.5</span>, nan],</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>       [<span class="dv">2001</span>, <span class="st">'Ohio'</span>, <span class="fl">1.7</span>, nan],</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>       [<span class="dv">2002</span>, <span class="st">'Ohio'</span>, <span class="fl">3.6</span>, <span class="op">-</span><span class="fl">1.2</span>],</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>       [<span class="dv">2001</span>, <span class="st">'Nevada'</span>, <span class="fl">2.4</span>, nan],</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>       [<span class="dv">2002</span>, <span class="st">'Nevada'</span>, <span class="fl">2.9</span>, <span class="op">-</span><span class="fl">1.5</span>],</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>       [<span class="dv">2003</span>, <span class="st">'Nevada'</span>, <span class="fl">3.2</span>, <span class="op">-</span><span class="fl">1.7</span>]], dtype<span class="op">=</span><span class="bu">object</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="index-objects" class="level3" data-number="5.1.3">
<h3 data-number="5.1.3" class="anchored" data-anchor-id="index-objects"><span class="header-section-number">5.1.3</span> Index Objects</h3>
<p>pandas 的 Index 对象负责保存轴标签（包括 DataFrame 的列名称）和其他元数据（如轴名称或名称）。构建 Series 或 DataFrame 时使用的任何数组或其他标签序列都会在内部转换为 Index：</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">84</span>]: obj <span class="op">=</span> pd.Series(np.arange(<span class="dv">3</span>), index<span class="op">=</span>[<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>])</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">85</span>]: index <span class="op">=</span> obj.index</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">86</span>]: index</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">86</span>]: Index([<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>], dtype<span class="op">=</span><span class="st">'object'</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">87</span>]: index[<span class="dv">1</span>:]</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">87</span>]: Index([<span class="st">'b'</span>, <span class="st">'c'</span>], dtype<span class="op">=</span><span class="st">'object'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Index 对象是不可变的，因此用户不能修改：</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>index[<span class="dv">1</span>] <span class="op">=</span> <span class="st">"d"</span>  <span class="co"># TypeError</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>不变性使得在数据结构之间共享 Index 对象更加安全：</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">88</span>]: labels <span class="op">=</span> pd.Index(np.arange(<span class="dv">3</span>))</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">89</span>]: labels</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">89</span>]: Index([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>], dtype<span class="op">=</span><span class="st">'int64'</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">90</span>]: obj2 <span class="op">=</span> pd.Series([<span class="fl">1.5</span>, <span class="op">-</span><span class="fl">2.5</span>, <span class="dv">0</span>], index<span class="op">=</span>labels)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">91</span>]: obj2</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">91</span>]: </span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="fl">1.5</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   <span class="op">-</span><span class="fl">2.5</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="fl">0.0</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>dtype: float64</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">92</span>]: obj2.index <span class="kw">is</span> labels</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">92</span>]: <span class="va">True</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>有些用户不会经常利用 Index 提供的功能，但由于某些操作会产生包含索引数据的结果，因此了解它们的工作原理非常重要。</p>
</div>
</div>
<p>除了类似于数组之外，索引的行为也类似于固定大小的集合：</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">93</span>]: frame3</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">93</span>]: </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>state  Ohio  Nevada</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>year               </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2000</span>    <span class="fl">1.5</span>     NaN</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2001</span>    <span class="fl">1.7</span>     <span class="fl">2.4</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2002</span>    <span class="fl">3.6</span>     <span class="fl">2.9</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">94</span>]: frame3.columns</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">94</span>]: Index([<span class="st">'Ohio'</span>, <span class="st">'Nevada'</span>], dtype<span class="op">=</span><span class="st">'object'</span>, name<span class="op">=</span><span class="st">'state'</span>)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">95</span>]: <span class="st">"Ohio"</span> <span class="kw">in</span> frame3.columns</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">95</span>]: <span class="va">True</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">96</span>]: <span class="dv">2003</span> <span class="kw">in</span> frame3.index</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">96</span>]: <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>与 Python 集合不同，pandas 索引可以包含重复标签：</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">97</span>]: pd.Index([<span class="st">"foo"</span>, <span class="st">"foo"</span>, <span class="st">"bar"</span>, <span class="st">"bar"</span>])</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">97</span>]: Index([<span class="st">'foo'</span>, <span class="st">'foo'</span>, <span class="st">'bar'</span>, <span class="st">'bar'</span>], dtype<span class="op">=</span><span class="st">'object'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>具有重复标签的选择将选择该标签的所有出现位置。</p>
<p>每个索引都有许多用于集合逻辑的方法和属性，它们回答了有关其包含的数据的其他常见问题。<a href="https://wesmckinney.com/book/pandas-basics#tbl-table_index_methods">Table 5.2</a> 总结了一些有用的内容。</p>
<table class="table">
<caption>Table 5.2: Some Index methods and properties</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Method/Property</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>append()</code></td>
<td style="text-align: left;">与其他 Index 对象连接，生成新的 Index</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>difference()</code></td>
<td style="text-align: left;">将集合差异计算为 Index</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>intersection()</code></td>
<td style="text-align: left;">计算集合交集</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>union()</code></td>
<td style="text-align: left;">计算集并集</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>isin()</code></td>
<td style="text-align: left;">计算布尔数组，指示每个值是否包含在传递的集合中</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>delete()</code></td>
<td style="text-align: left;">删除索引 <code>i</code> 处的元素计算新索引</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>drop()</code></td>
<td style="text-align: left;">通过删除传递的值来计算新索引</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>insert()</code></td>
<td style="text-align: left;">通过在索引 <code>i</code> 处插入元素来计算新索引</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>is_monotonic</code></td>
<td style="text-align: left;">如果每个元素大于或等于前一个元素，则返回 <code>True</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>is_unique</code></td>
<td style="text-align: left;">如果索引没有重复值，则返回 <code>True</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>unique()</code></td>
<td style="text-align: left;">计算索引中唯一值的数组</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="essential-functionality" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="essential-functionality"><span class="header-section-number">5.2</span> Essential Functionality</h2>
<p>本节将引导您了解与 Series 或 DataFrame 中包含的数据进行交互的基本机制。在接下来的章节中，我们将更深入地研究使用 pandas 进行数据分析和操作的主题。本书无意作为 pandas 库的详尽文档；相反，我们将专注于让您熟悉常用的功能，而将不太常见（即更深奥）的内容留给您通过阅读在线 pandas 文档来了解更多信息。</p>
<section id="reindexing" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="reindexing"><span class="header-section-number">5.2.1</span> Reindexing</h3>
<p>pandas 对象的一个​​重要方法是 <code>reindex</code>，这意味着创建一个新对象，并重新排列值以与新索引对齐。考虑一个例子：</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">98</span>]: obj <span class="op">=</span> pd.Series([<span class="fl">4.5</span>, <span class="fl">7.2</span>, <span class="op">-</span><span class="fl">5.3</span>, <span class="fl">3.6</span>], index<span class="op">=</span>[<span class="st">"d"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"c"</span>])</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">99</span>]: obj</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">99</span>]: </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>d    <span class="fl">4.5</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>b    <span class="fl">7.2</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>a   <span class="op">-</span><span class="fl">5.3</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>c    <span class="fl">3.6</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>在此 Series 上调用 <code>reindex</code> 会根据新索引重新排列数据，如果尚不存在任何索引值，则会引入缺失值：</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">100</span>]: obj2 <span class="op">=</span> obj.reindex([<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span>])</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">101</span>]: obj2</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">101</span>]: </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>a   <span class="op">-</span><span class="fl">5.3</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>b    <span class="fl">7.2</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>c    <span class="fl">3.6</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>d    <span class="fl">4.5</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>e    NaN</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>对于时间序列等有序数据，您可能需要在重新索引时进行一些插值或填充值。 <code>method</code> 选项允许我们使用诸如 <code>ffill</code> 之类的方法来执行此操作，该方法向前填充值：</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">102</span>]: obj3 <span class="op">=</span> pd.Series([<span class="st">"blue"</span>, <span class="st">"purple"</span>, <span class="st">"yellow"</span>], index<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>])</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">103</span>]: obj3</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">103</span>]: </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>      blue</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    purple</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    yellow</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">object</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">104</span>]: obj3.reindex(np.arange(<span class="dv">6</span>), method<span class="op">=</span><span class="st">"ffill"</span>)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">104</span>]: </span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>      blue</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>      blue</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    purple</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    purple</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    yellow</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    yellow</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>使用 DataFrame，<code>reindex</code> 可以更改（行）索引、列或两者。当仅传递一个序列时，它会重新索引结果中的行：</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">105</span>]: frame <span class="op">=</span> pd.DataFrame(np.arange(<span class="dv">9</span>).reshape((<span class="dv">3</span>, <span class="dv">3</span>)),</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>   .....:                      index<span class="op">=</span>[<span class="st">"a"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>],</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>   .....:                      columns<span class="op">=</span>[<span class="st">"Ohio"</span>, <span class="st">"Texas"</span>, <span class="st">"California"</span>])</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">106</span>]: frame</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">106</span>]: </span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>   Ohio  Texas  California</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>a     <span class="dv">0</span>      <span class="dv">1</span>           <span class="dv">2</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>c     <span class="dv">3</span>      <span class="dv">4</span>           <span class="dv">5</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>d     <span class="dv">6</span>      <span class="dv">7</span>           <span class="dv">8</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">107</span>]: frame2 <span class="op">=</span> frame.reindex(index<span class="op">=</span>[<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>])</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">108</span>]: frame2</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">108</span>]: </span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>   Ohio  Texas  California</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>a   <span class="fl">0.0</span>    <span class="fl">1.0</span>         <span class="fl">2.0</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>b   NaN    NaN         NaN</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>c   <span class="fl">3.0</span>    <span class="fl">4.0</span>         <span class="fl">5.0</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>d   <span class="fl">6.0</span>    <span class="fl">7.0</span>         <span class="fl">8.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>可以使用 <code>columns</code> 关键字对列重新索引：</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">109</span>]: states <span class="op">=</span> [<span class="st">"Texas"</span>, <span class="st">"Utah"</span>, <span class="st">"California"</span>]</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">110</span>]: frame.reindex(columns<span class="op">=</span>states)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">110</span>]: </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>   Texas  Utah  California</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>a      <span class="dv">1</span>   NaN           <span class="dv">2</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>c      <span class="dv">4</span>   NaN           <span class="dv">5</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>d      <span class="dv">7</span>   NaN           <span class="dv">8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>由于 <code>"Ohio"</code> 不在 <code>states</code> 内，因此该列的数据将从结果中删除。</p>
<p>重新索引特定轴的另一种方法是将新轴标签作为位置参数传递，然后使用 <code>axis</code> 关键字指定要重新索引的轴：</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">111</span>]: frame.reindex(states, axis<span class="op">=</span><span class="st">"columns"</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">111</span>]: </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>   Texas  Utah  California</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>a      <span class="dv">1</span>   NaN           <span class="dv">2</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>c      <span class="dv">4</span>   NaN           <span class="dv">5</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>d      <span class="dv">7</span>   NaN           <span class="dv">8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>有关 <code>reindex</code> 参数的更多信息，请参阅 <a href="https://wesmckinney.com/book/pandas-basics#tbl-table_reindex_function">Table 5.3</a>。</p>
<table class="table">
<caption>Table 5.3: <code>reindex</code> function arguments</caption>
<colgroup>
<col style="width: 62%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Argument</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>labels</code></td>
<td style="text-align: left;">用作索引的新序列。可以是 Index 实例或任何其他类似序列的 Python 数据结构。索引将按原样使用，无需任何复制。</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>index</code></td>
<td style="text-align: left;">使用传递的序列作为新的索引标签。</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>columns</code></td>
<td style="text-align: left;">使用传递的序列作为新的列标签。</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>axis</code></td>
<td style="text-align: left;">要重新索引的轴，无论是 <code>"index"</code>（行）还是 <code>"columns"</code>。默认值为 <code>"index"</code>。您可以选择执行 <code>reindex(index=new_labels)</code> 或 <code>reindex(columns=new_labels)</code>。</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>method</code></td>
<td style="text-align: left;">插值（填充）法；<code>"ffill"</code> 向前填充，而 <code>"bfill"</code> 向后填充。</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fill_value</code></td>
<td style="text-align: left;">通过重新索引引入缺失数据时要使用的替代值。当您希望结果中缺少的标签具有空值时，请使用 <code>fill_value="missing"</code> （默认行为）。</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>limit</code></td>
<td style="text-align: left;">前向填充或回填时，要填充的最大间隙（以元素数量为单位）。</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>tolerance</code></td>
<td style="text-align: left;">向前填充或回填时，用于填充不精确匹配的最大尺寸间隙（以绝对数字距离表示）。</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>level</code></td>
<td style="text-align: left;">在 MultiIndex 级别上匹配简单索引；否则选择子集。</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>copy</code></td>
<td style="text-align: left;">如果为 <code>True</code>，则始终复制基础数据，即使新索引与旧索引等效；如果为 <code>False</code>，则当索引相等时不复制数据。</td>
</tr>
</tbody>
</table>
<p>正如我们稍后将在 <a href="https://wesmckinney.com/book/pandas-basics#pandas-loc-iloc">Selection on DataFrame with loc and iloc</a> 中探讨的那样，您还可以使用 <code>loc</code> 运算符重新索引，并且许多用户更喜欢始终这样做。仅当所有新索引标签已存在于 DataFrame 中时，此方法才有效（而 <code>reindex</code> 将为新标签插入缺失的数据）：</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">112</span>]: frame.loc[[<span class="st">"a"</span>, <span class="st">"d"</span>, <span class="st">"c"</span>], [<span class="st">"California"</span>, <span class="st">"Texas"</span>]]</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">112</span>]: </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>   California  Texas</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>a           <span class="dv">2</span>      <span class="dv">1</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>d           <span class="dv">8</span>      <span class="dv">7</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>c           <span class="dv">5</span>      <span class="dv">4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="dropping-entries-from-an-axis" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="dropping-entries-from-an-axis"><span class="header-section-number">5.2.2</span> Dropping Entries from an Axis</h3>
<p>如果您已经有一个没有这些条目的索引数组或列表，则从轴中删除一个或多个条目很简单，因为您可以使用 <code>reindex</code> 方法或基于 <code>.loc</code> 的索引。由于这可能需要一些修改和设置逻辑，因此 <code>drop</code> 方法将返回一个新对象，其中包含从轴删除的一个或多个指示值：</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">113</span>]: obj <span class="op">=</span> pd.Series(np.arange(<span class="fl">5.</span>), index<span class="op">=</span>[<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span>])</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">114</span>]: obj</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">114</span>]: </span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>a    <span class="fl">0.0</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>b    <span class="fl">1.0</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>c    <span class="fl">2.0</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>d    <span class="fl">3.0</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>e    <span class="fl">4.0</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>dtype: float64</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">115</span>]: new_obj <span class="op">=</span> obj.drop(<span class="st">"c"</span>)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">116</span>]: new_obj</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">116</span>]: </span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>a    <span class="fl">0.0</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>b    <span class="fl">1.0</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>d    <span class="fl">3.0</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>e    <span class="fl">4.0</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>dtype: float64</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">117</span>]: obj.drop([<span class="st">"d"</span>, <span class="st">"c"</span>])</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">117</span>]: </span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>a    <span class="fl">0.0</span></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>b    <span class="fl">1.0</span></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>e    <span class="fl">4.0</span></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>使用 DataFrame，可以从任一轴删除索引值。为了说明这一点，我们首先创建一个示例 DataFrame：</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">118</span>]: data <span class="op">=</span> pd.DataFrame(np.arange(<span class="dv">16</span>).reshape((<span class="dv">4</span>, <span class="dv">4</span>)),</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>   .....:                     index<span class="op">=</span>[<span class="st">"Ohio"</span>, <span class="st">"Colorado"</span>, <span class="st">"Utah"</span>, <span class="st">"New York"</span>],</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>   .....:                     columns<span class="op">=</span>[<span class="st">"one"</span>, <span class="st">"two"</span>, <span class="st">"three"</span>, <span class="st">"four"</span>])</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">119</span>]: data</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">119</span>]: </span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>          one  two  three  four</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>Ohio        <span class="dv">0</span>    <span class="dv">1</span>      <span class="dv">2</span>     <span class="dv">3</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>Colorado    <span class="dv">4</span>    <span class="dv">5</span>      <span class="dv">6</span>     <span class="dv">7</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>Utah        <span class="dv">8</span>    <span class="dv">9</span>     <span class="dv">10</span>    <span class="dv">11</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>New York   <span class="dv">12</span>   <span class="dv">13</span>     <span class="dv">14</span>    <span class="dv">15</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>使用一系列标签调用 <code>drop</code> 将从行标签（axis 0）中删除值：</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">120</span>]: data.drop(index<span class="op">=</span>[<span class="st">"Colorado"</span>, <span class="st">"Ohio"</span>])</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">120</span>]: </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>          one  two  three  four</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>Utah        <span class="dv">8</span>    <span class="dv">9</span>     <span class="dv">10</span>    <span class="dv">11</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>New York   <span class="dv">12</span>   <span class="dv">13</span>     <span class="dv">14</span>    <span class="dv">15</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>要从列中删除标签，请使用 <code>columns</code> 关键字：</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">121</span>]: data.drop(columns<span class="op">=</span>[<span class="st">"two"</span>])</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">121</span>]: </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>          one  three  four</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>Ohio        <span class="dv">0</span>      <span class="dv">2</span>     <span class="dv">3</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>Colorado    <span class="dv">4</span>      <span class="dv">6</span>     <span class="dv">7</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>Utah        <span class="dv">8</span>     <span class="dv">10</span>    <span class="dv">11</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>New York   <span class="dv">12</span>     <span class="dv">14</span>    <span class="dv">15</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>您还可以通过传递 <code>axis=1</code> （类似于 NumPy）或 <code>axis="columns"</code> 来删除列中的值：</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">122</span>]: data.drop(<span class="st">"two"</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">122</span>]: </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>          one  three  four</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>Ohio        <span class="dv">0</span>      <span class="dv">2</span>     <span class="dv">3</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>Colorado    <span class="dv">4</span>      <span class="dv">6</span>     <span class="dv">7</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>Utah        <span class="dv">8</span>     <span class="dv">10</span>    <span class="dv">11</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>New York   <span class="dv">12</span>     <span class="dv">14</span>    <span class="dv">15</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">123</span>]: data.drop([<span class="st">"two"</span>, <span class="st">"four"</span>], axis<span class="op">=</span><span class="st">"columns"</span>)</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">123</span>]: </span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>          one  three</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>Ohio        <span class="dv">0</span>      <span class="dv">2</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>Colorado    <span class="dv">4</span>      <span class="dv">6</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>Utah        <span class="dv">8</span>     <span class="dv">10</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>New York   <span class="dv">12</span>     <span class="dv">14</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="indexing-selection-and-filtering" class="level3" data-number="5.2.3">
<h3 data-number="5.2.3" class="anchored" data-anchor-id="indexing-selection-and-filtering"><span class="header-section-number">5.2.3</span> Indexing, Selection, and Filtering</h3>
<p>Series 索引 (<code>obj[...]</code>) 的工作方式与 NumPy 数组索引类似，只不过您可以使用 Series 的索引值而不仅仅是整数。以下是一些例子：</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">124</span>]: obj <span class="op">=</span> pd.Series(np.arange(<span class="fl">4.</span>), index<span class="op">=</span>[<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>])</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">125</span>]: obj</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">125</span>]: </span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>a    <span class="fl">0.0</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>b    <span class="fl">1.0</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>c    <span class="fl">2.0</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>d    <span class="fl">3.0</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>dtype: float64</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">126</span>]: obj[<span class="st">"b"</span>]</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">126</span>]: <span class="fl">1.0</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">127</span>]: obj[<span class="dv">1</span>]</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">127</span>]: <span class="fl">1.0</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">128</span>]: obj[<span class="dv">2</span>:<span class="dv">4</span>]</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">128</span>]: </span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>c    <span class="fl">2.0</span></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>d    <span class="fl">3.0</span></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>dtype: float64</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">129</span>]: obj[[<span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"d"</span>]]</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">129</span>]: </span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>b    <span class="fl">1.0</span></span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>a    <span class="fl">0.0</span></span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>d    <span class="fl">3.0</span></span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>dtype: float64</span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">130</span>]: obj[[<span class="dv">1</span>, <span class="dv">3</span>]]</span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">130</span>]: </span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a>b    <span class="fl">1.0</span></span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a>d    <span class="fl">3.0</span></span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a>dtype: float64</span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">131</span>]: obj[obj <span class="op">&lt;</span> <span class="dv">2</span>]</span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">131</span>]: </span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a>a    <span class="fl">0.0</span></span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a>b    <span class="fl">1.0</span></span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>虽然您可以通过这种方式通过标签选择数据，但选择索引值的首选方法是使用特殊的 <code>loc</code> 运算符：</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">132</span>]: obj.loc[[<span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"d"</span>]]</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">132</span>]: </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>b    <span class="fl">1.0</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>a    <span class="fl">0.0</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>d    <span class="fl">3.0</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>更喜欢 <code>loc</code> 的原因是因为用 <code>[]</code> 索引时对整数的处理不同。如果索引包含整数，则基于常规 <code>[]</code> 的索引会将整数视为标签，因此行为会根据索引的数据类型而有所不同。例如：</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">133</span>]: obj1 <span class="op">=</span> pd.Series([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], index<span class="op">=</span>[<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">134</span>]: obj2 <span class="op">=</span> pd.Series([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], index<span class="op">=</span>[<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>])</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">135</span>]: obj1</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">135</span>]: </span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="dv">1</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="dv">2</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="dv">3</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>dtype: int64</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">136</span>]: obj2</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">136</span>]: </span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>a    <span class="dv">1</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">2</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>c    <span class="dv">3</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>dtype: int64</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">137</span>]: obj1[[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>]]</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">137</span>]: </span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="dv">2</span></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="dv">3</span></span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="dv">1</span></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>dtype: int64</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">138</span>]: obj2[[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>]]</span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">138</span>]: </span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>a    <span class="dv">1</span></span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">2</span></span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>c    <span class="dv">3</span></span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>使用 <code>loc</code> 时，当索引不包含整数时，表达式 <code>obj.loc[[0, 1, 2]]</code> 将失败：</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">134</span>]: obj2.loc[[<span class="dv">0</span>, <span class="dv">1</span>]]</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="op">---------------------------------------------------------------------------</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="pp">KeyError</span>                                  Traceback (most recent call last)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="op">/</span>tmp<span class="op">/</span>ipykernel_804589<span class="op">/</span><span class="fl">4185657903.</span><span class="er">py</span> <span class="kw">in</span> <span class="op">&lt;</span>module<span class="op">&gt;</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="op">----&gt;</span> <span class="dv">1</span> obj2.loc[[<span class="dv">0</span>, <span class="dv">1</span>]]</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="op">^</span> LONG EXCEPTION ABBREVIATED <span class="op">^</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="pp">KeyError</span>: <span class="st">"None of [Int64Index([0, 1], dtype="</span>int64<span class="st">")] are in the [index]"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>由于 <code>loc</code> 运算符仅使用标签进行索引，因此还有一个 <code>iloc</code> 运算符仅使用整数进行索引，无论索引是否包含整数，都可以一致地工作：</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">139</span>]: obj1.iloc[[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>]]</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">139</span>]: </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="dv">1</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="dv">2</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="dv">3</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>dtype: int64</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">140</span>]: obj2.iloc[[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>]]</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">140</span>]: </span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>a    <span class="dv">1</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">2</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>c    <span class="dv">3</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>您还可以使用标签进行切片，但它的工作方式与普通 Python 切片不同，因为端点是包含的：</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">141</span>]: obj2.loc[<span class="st">"b"</span>:<span class="st">"c"</span>]</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">141</span>]: </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">2</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>c    <span class="dv">3</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>使用这些方法赋值会修改 Series 的相应部分：</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">142</span>]: obj2.loc[<span class="st">"b"</span>:<span class="st">"c"</span>] <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">143</span>]: obj2</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">143</span>]: </span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>a    <span class="dv">1</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">5</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>c    <span class="dv">5</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>尝试调用类似 <code>loc</code> 或 <code>iloc</code> 的函数而不是用方括号“索引”它们可能是一个常见的新手错误。方括号表示法用于启用切片操作并允许使用 DataFrame 对象在多个轴上进行索引。</p>
</div>
</div>
<p>对 DataFrame 进行索引可检索具有单个值或序列的一列或多列：</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">144</span>]: data <span class="op">=</span> pd.DataFrame(np.arange(<span class="dv">16</span>).reshape((<span class="dv">4</span>, <span class="dv">4</span>)),</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>   .....:                     index<span class="op">=</span>[<span class="st">"Ohio"</span>, <span class="st">"Colorado"</span>, <span class="st">"Utah"</span>, <span class="st">"New York"</span>],</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>   .....:                     columns<span class="op">=</span>[<span class="st">"one"</span>, <span class="st">"two"</span>, <span class="st">"three"</span>, <span class="st">"four"</span>])</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">145</span>]: data</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">145</span>]: </span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>          one  two  three  four</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>Ohio        <span class="dv">0</span>    <span class="dv">1</span>      <span class="dv">2</span>     <span class="dv">3</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>Colorado    <span class="dv">4</span>    <span class="dv">5</span>      <span class="dv">6</span>     <span class="dv">7</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>Utah        <span class="dv">8</span>    <span class="dv">9</span>     <span class="dv">10</span>    <span class="dv">11</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>New York   <span class="dv">12</span>   <span class="dv">13</span>     <span class="dv">14</span>    <span class="dv">15</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">146</span>]: data[<span class="st">"two"</span>]</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">146</span>]: </span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>Ohio         <span class="dv">1</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>Colorado     <span class="dv">5</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>Utah         <span class="dv">9</span></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>New York    <span class="dv">13</span></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>Name: two, dtype: int64</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">147</span>]: data[[<span class="st">"three"</span>, <span class="st">"one"</span>]]</span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">147</span>]: </span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>          three  one</span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>Ohio          <span class="dv">2</span>    <span class="dv">0</span></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>Colorado      <span class="dv">6</span>    <span class="dv">4</span></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>Utah         <span class="dv">10</span>    <span class="dv">8</span></span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a>New York     <span class="dv">14</span>   <span class="dv">12</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>像这样的索引有一些特殊情况。第一个是使用布尔数组切片或选择数据：</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">148</span>]: data[:<span class="dv">2</span>]</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">148</span>]: </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>          one  two  three  four</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>Ohio        <span class="dv">0</span>    <span class="dv">1</span>      <span class="dv">2</span>     <span class="dv">3</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>Colorado    <span class="dv">4</span>    <span class="dv">5</span>      <span class="dv">6</span>     <span class="dv">7</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">149</span>]: data[data[<span class="st">"three"</span>] <span class="op">&gt;</span> <span class="dv">5</span>]</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">149</span>]: </span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>          one  two  three  four</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>Colorado    <span class="dv">4</span>    <span class="dv">5</span>      <span class="dv">6</span>     <span class="dv">7</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>Utah        <span class="dv">8</span>    <span class="dv">9</span>     <span class="dv">10</span>    <span class="dv">11</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>New York   <span class="dv">12</span>   <span class="dv">13</span>     <span class="dv">14</span>    <span class="dv">15</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>提供行选择语法 <code>data[:2]</code> 是为了方便起见。将单个元素或列表传递给 <code>[]</code> 运算符会选择列。</p>
<p>另一个用例是使用布尔 DataFrame 进行索引，例如通过标量比较生成的索引。考虑一个 DataFrame，其中所有布尔值都是通过与标量值进行比较而生成的：</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">150</span>]: data <span class="op">&lt;</span> <span class="dv">5</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">150</span>]: </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>            one    two  three   four</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>Ohio       <span class="va">True</span>   <span class="va">True</span>   <span class="va">True</span>   <span class="va">True</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>Colorado   <span class="va">True</span>  <span class="va">False</span>  <span class="va">False</span>  <span class="va">False</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>Utah      <span class="va">False</span>  <span class="va">False</span>  <span class="va">False</span>  <span class="va">False</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>New York  <span class="va">False</span>  <span class="va">False</span>  <span class="va">False</span>  <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>我们可以使用此 DataFrame 将值 0 分配给值为 <code>True</code> 的每个位置，如下所示：</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">151</span>]: data[data <span class="op">&lt;</span> <span class="dv">5</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">152</span>]: data</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">152</span>]: </span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>          one  two  three  four</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>Ohio        <span class="dv">0</span>    <span class="dv">0</span>      <span class="dv">0</span>     <span class="dv">0</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>Colorado    <span class="dv">0</span>    <span class="dv">5</span>      <span class="dv">6</span>     <span class="dv">7</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>Utah        <span class="dv">8</span>    <span class="dv">9</span>     <span class="dv">10</span>    <span class="dv">11</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>New York   <span class="dv">12</span>   <span class="dv">13</span>     <span class="dv">14</span>    <span class="dv">15</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Selection on DataFrame with loc and iloc</strong></p>
<p>与 Series 一样，DataFrame 具有特殊属性 <code>loc</code> 和 <code>iloc</code>，分别用于基于标签和基于整数的索引。由于 DataFrame 是二维的，因此您可以使用轴标签 (<code>loc</code>) 或整数 (<code>iloc</code>) 以类似 NumPy 的表示法选择行和列的子集。</p>
<p>作为第一个示例，让我们按标签选择一行：</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">153</span>]: data</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">153</span>]: </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>          one  two  three  four</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>Ohio        <span class="dv">0</span>    <span class="dv">0</span>      <span class="dv">0</span>     <span class="dv">0</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>Colorado    <span class="dv">0</span>    <span class="dv">5</span>      <span class="dv">6</span>     <span class="dv">7</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>Utah        <span class="dv">8</span>    <span class="dv">9</span>     <span class="dv">10</span>    <span class="dv">11</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>New York   <span class="dv">12</span>   <span class="dv">13</span>     <span class="dv">14</span>    <span class="dv">15</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">154</span>]: data.loc[<span class="st">"Colorado"</span>]</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">154</span>]: </span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>one      <span class="dv">0</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>two      <span class="dv">5</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>three    <span class="dv">6</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>four     <span class="dv">7</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>Name: Colorado, dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>选择单行的结果是一个 Series，其索引包含 DataFrame 的列标签。要选择多个角色，创建一个新的 DataFrame，传递一系列标签：</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">155</span>]: data.loc[[<span class="st">"Colorado"</span>, <span class="st">"New York"</span>]]</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">155</span>]: </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>          one  two  three  four</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>Colorado    <span class="dv">0</span>    <span class="dv">5</span>      <span class="dv">6</span>     <span class="dv">7</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>New York   <span class="dv">12</span>   <span class="dv">13</span>     <span class="dv">14</span>    <span class="dv">15</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>您可以通过用逗号分隔选择来组合 <code>loc</code> 中的行和列选择：</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">156</span>]: data.loc[<span class="st">"Colorado"</span>, [<span class="st">"two"</span>, <span class="st">"three"</span>]]</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">156</span>]: </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>two      <span class="dv">5</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>three    <span class="dv">6</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>Name: Colorado, dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>然后，我们将使用 <code>iloc</code> 对整数执行一些类似的选择：</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">157</span>]: data.iloc[<span class="dv">2</span>]</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">157</span>]: </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>one       <span class="dv">8</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>two       <span class="dv">9</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>three    <span class="dv">10</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>four     <span class="dv">11</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>Name: Utah, dtype: int64</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">158</span>]: data.iloc[[<span class="dv">2</span>, <span class="dv">1</span>]]</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">158</span>]: </span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>          one  two  three  four</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>Utah        <span class="dv">8</span>    <span class="dv">9</span>     <span class="dv">10</span>    <span class="dv">11</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>Colorado    <span class="dv">0</span>    <span class="dv">5</span>      <span class="dv">6</span>     <span class="dv">7</span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">159</span>]: data.iloc[<span class="dv">2</span>, [<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>]]</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">159</span>]: </span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>four    <span class="dv">11</span></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>one      <span class="dv">8</span></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>two      <span class="dv">9</span></span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>Name: Utah, dtype: int64</span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">160</span>]: data.iloc[[<span class="dv">1</span>, <span class="dv">2</span>], [<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>]]</span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">160</span>]: </span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>          four  one  two</span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>Colorado     <span class="dv">7</span>    <span class="dv">0</span>    <span class="dv">5</span></span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>Utah        <span class="dv">11</span>    <span class="dv">8</span>    <span class="dv">9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>除了单个标签或标签列表之外，这两个索引函数还可以使用切片：</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">161</span>]: data.loc[:<span class="st">"Utah"</span>, <span class="st">"two"</span>]</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">161</span>]: </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>Ohio        <span class="dv">0</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>Colorado    <span class="dv">5</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>Utah        <span class="dv">9</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>Name: two, dtype: int64</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">162</span>]: data.iloc[:, :<span class="dv">3</span>][data.three <span class="op">&gt;</span> <span class="dv">5</span>]</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">162</span>]: </span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>          one  two  three</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>Colorado    <span class="dv">0</span>    <span class="dv">5</span>      <span class="dv">6</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>Utah        <span class="dv">8</span>    <span class="dv">9</span>     <span class="dv">10</span></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>New York   <span class="dv">12</span>   <span class="dv">13</span>     <span class="dv">14</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>布尔数组可以与 <code>loc</code> 一起使用，但不能与 <code>iloc</code> 一起使用：</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">163</span>]: data.loc[data.three <span class="op">&gt;=</span> <span class="dv">2</span>]</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">163</span>]: </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>          one  two  three  four</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>Colorado    <span class="dv">0</span>    <span class="dv">5</span>      <span class="dv">6</span>     <span class="dv">7</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>Utah        <span class="dv">8</span>    <span class="dv">9</span>     <span class="dv">10</span>    <span class="dv">11</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>New York   <span class="dv">12</span>   <span class="dv">13</span>     <span class="dv">14</span>    <span class="dv">15</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>有多种方法可以选择和重新排列 pandas 对象中包含的数据。对于 DataFrame，<a href="https://wesmckinney.com/book/pandas-basics#tbl-table_dataframe_loc_iloc">Table 5.4</a> 提供了其中许多内容的简短摘要。正如您稍后将看到的，还有许多用于处理分层索引的附加选项。</p>
<table class="table">
<caption>Table 5.4: Indexing options with DataFrame</caption>
<colgroup>
<col style="width: 62%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>df[column]</code></td>
<td style="text-align: left;">从 DataFrame 中选择单列或列序列；特殊情况的便利：布尔数组（过滤行）、切片（切片行）或布尔 DataFrame（根据某些标准设置值）</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>df.loc[rows]</code></td>
<td style="text-align: left;">按标签从 DataFrame 中选择单行或行子集</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>df.loc[:, cols]</code></td>
<td style="text-align: left;">按标签选择单列或列的子集</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>df.loc[rows, cols]</code></td>
<td style="text-align: left;">通过标签选择行和列</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>df.iloc[rows]</code></td>
<td style="text-align: left;">按整数位置从 DataFrame 中选择单行或行子集</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>df.iloc[:, cols]</code></td>
<td style="text-align: left;">按整数位置选择单列或列子集</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>df.iloc[rows, cols]</code></td>
<td style="text-align: left;">按整数位置选择行和列</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>df.iat[row, col]</code></td>
<td style="text-align: left;">按行和列位置（整数）选择单个标量值</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>reindex</code></td>
<td style="text-align: left;">通过标签选择行或列</td>
</tr>
</tbody>
</table>
<p><strong>Integer indexing pitfalls</strong></p>
<p>使用由整数索引的 pandas 对象可能会成为新用户的绊脚石，因为它们的工作方式与内置的 Python 数据结构（如列表和元组）不同。例如，您可能不希望以下代码生成错误：</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">164</span>]: ser <span class="op">=</span> pd.Series(np.arange(<span class="fl">3.</span>))</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">165</span>]: ser</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">165</span>]: </span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="fl">0.0</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="fl">1.0</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="fl">2.0</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>dtype: float64</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">166</span>]: ser[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a><span class="op">---------------------------------------------------------------------------</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a><span class="pp">ValueError</span>                                Traceback (most recent call last)</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a><span class="op">~/</span>miniforge<span class="op">-</span>x86<span class="op">/</span>envs<span class="op">/</span>book<span class="op">-</span>env<span class="op">/</span>lib<span class="op">/</span>python3<span class="fl">.10</span><span class="op">/</span>site<span class="op">-</span>packages<span class="op">/</span>pandas<span class="op">/</span>core<span class="op">/</span>indexes<span class="op">/</span>ra</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>nge.py <span class="kw">in</span> get_loc(<span class="va">self</span>, key)</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>    <span class="dv">344</span>             <span class="cf">try</span>:</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a><span class="op">--&gt;</span> <span class="dv">345</span>                 <span class="cf">return</span> <span class="va">self</span>._range.index(new_key)</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>    <span class="dv">346</span>             <span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> err:</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a><span class="pp">ValueError</span>: <span class="op">-</span><span class="dv">1</span> <span class="kw">is</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">range</span></span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>The above exception was the direct cause of the following exception:</span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a><span class="pp">KeyError</span>                                  Traceback (most recent call last)</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>ipython<span class="op">-</span><span class="bu">input</span><span class="op">-</span><span class="dv">166</span><span class="op">-</span><span class="dv">44969</span><span class="er">a759c20</span><span class="op">&gt;</span> <span class="kw">in</span> <span class="op">&lt;</span>module<span class="op">&gt;</span></span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a><span class="op">----&gt;</span> <span class="dv">1</span> ser[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a><span class="op">~/</span>miniforge<span class="op">-</span>x86<span class="op">/</span>envs<span class="op">/</span>book<span class="op">-</span>env<span class="op">/</span>lib<span class="op">/</span>python3<span class="fl">.10</span><span class="op">/</span>site<span class="op">-</span>packages<span class="op">/</span>pandas<span class="op">/</span>core<span class="op">/</span>series.py </span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a><span class="kw">in</span> <span class="fu">__getitem__</span>(<span class="va">self</span>, key)</span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>   <span class="dv">1010</span> </span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a>   <span class="dv">1011</span>         <span class="cf">elif</span> key_is_scalar:</span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a><span class="op">-&gt;</span> <span class="dv">1012</span>             <span class="cf">return</span> <span class="va">self</span>._get_value(key)</span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a>   <span class="dv">1013</span> </span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a>   <span class="dv">1014</span>         <span class="cf">if</span> is_hashable(key):</span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a><span class="op">~/</span>miniforge<span class="op">-</span>x86<span class="op">/</span>envs<span class="op">/</span>book<span class="op">-</span>env<span class="op">/</span>lib<span class="op">/</span>python3<span class="fl">.10</span><span class="op">/</span>site<span class="op">-</span>packages<span class="op">/</span>pandas<span class="op">/</span>core<span class="op">/</span>series.py </span>
<span id="cb71-31"><a href="#cb71-31" aria-hidden="true" tabindex="-1"></a><span class="kw">in</span> _get_value(<span class="va">self</span>, label, takeable)</span>
<span id="cb71-32"><a href="#cb71-32" aria-hidden="true" tabindex="-1"></a>   <span class="dv">1119</span> </span>
<span id="cb71-33"><a href="#cb71-33" aria-hidden="true" tabindex="-1"></a>   <span class="dv">1120</span>         <span class="co"># Similar to Index.get_value, but we do not fall back to position</span></span>
<span id="cb71-34"><a href="#cb71-34" aria-hidden="true" tabindex="-1"></a>al</span>
<span id="cb71-35"><a href="#cb71-35" aria-hidden="true" tabindex="-1"></a><span class="op">-&gt;</span> <span class="dv">1121</span>         loc <span class="op">=</span> <span class="va">self</span>.index.get_loc(label)</span>
<span id="cb71-36"><a href="#cb71-36" aria-hidden="true" tabindex="-1"></a>   <span class="dv">1122</span> </span>
<span id="cb71-37"><a href="#cb71-37" aria-hidden="true" tabindex="-1"></a>   <span class="dv">1123</span>         <span class="cf">if</span> is_integer(loc):</span>
<span id="cb71-38"><a href="#cb71-38" aria-hidden="true" tabindex="-1"></a><span class="op">~/</span>miniforge<span class="op">-</span>x86<span class="op">/</span>envs<span class="op">/</span>book<span class="op">-</span>env<span class="op">/</span>lib<span class="op">/</span>python3<span class="fl">.10</span><span class="op">/</span>site<span class="op">-</span>packages<span class="op">/</span>pandas<span class="op">/</span>core<span class="op">/</span>indexes<span class="op">/</span>ra</span>
<span id="cb71-39"><a href="#cb71-39" aria-hidden="true" tabindex="-1"></a>nge.py <span class="kw">in</span> get_loc(<span class="va">self</span>, key)</span>
<span id="cb71-40"><a href="#cb71-40" aria-hidden="true" tabindex="-1"></a>    <span class="dv">345</span>                 <span class="cf">return</span> <span class="va">self</span>._range.index(new_key)</span>
<span id="cb71-41"><a href="#cb71-41" aria-hidden="true" tabindex="-1"></a>    <span class="dv">346</span>             <span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> err:</span>
<span id="cb71-42"><a href="#cb71-42" aria-hidden="true" tabindex="-1"></a><span class="op">--&gt;</span> <span class="dv">347</span>                 <span class="cf">raise</span> <span class="pp">KeyError</span>(key) <span class="im">from</span> err</span>
<span id="cb71-43"><a href="#cb71-43" aria-hidden="true" tabindex="-1"></a>    <span class="dv">348</span>         <span class="va">self</span>._check_indexing_error(key)</span>
<span id="cb71-44"><a href="#cb71-44" aria-hidden="true" tabindex="-1"></a>    <span class="dv">349</span>         <span class="cf">raise</span> <span class="pp">KeyError</span>(key)</span>
<span id="cb71-45"><a href="#cb71-45" aria-hidden="true" tabindex="-1"></a><span class="pp">KeyError</span>: <span class="op">-</span><span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>在这种情况下，pandas 可以“回退(fall back)”整数索引，但通常很难在不向用户代码中引入细微错误的情况下做到这一点。这里我们有一个包含 <code>0</code>、<code>1</code> 和 <code>2</code> 的索引，但 pandas 不想猜测用户想要什么（基于标签的索引或基于位置的索引）：</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">167</span>]: ser</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">167</span>]: </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="fl">0.0</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="fl">1.0</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="fl">2.0</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>另一方面，对于非整数索引，就不存在这样的歧义：</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">168</span>]: ser2 <span class="op">=</span> pd.Series(np.arange(<span class="fl">3.</span>), index<span class="op">=</span>[<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>])</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">169</span>]: ser2[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">169</span>]: <span class="fl">2.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>如果您的轴索引包含整数，则数据选择将始终面向标签。正如我上面所说，如果您使用 <code>loc</code> （用于标签）或 <code>iloc</code> （用于整数），您将得到您想要的：</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">170</span>]: ser.iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">170</span>]: <span class="fl">2.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>另一方面，整数切片始终是面向整数的：</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">171</span>]: ser[:<span class="dv">2</span>]</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">171</span>]: </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="fl">0.0</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="fl">1.0</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>由于这些陷阱，最好始终首选使用 <code>loc</code> 和 <code>iloc</code> 进行索引以避免歧义。</p>
<p><strong>Pitfalls with chained indexing</strong></p>
<p>在上一节中，我们了解了如何使用 <code>loc</code> 和 <code>iloc</code> 在 DataFrame 上进行灵活的选择。这些索引属性也可用于就地修改 DataFrame 对象，但这样做需要小心。</p>
<p>例如，在上面的示例 DataFrame 中，我们可以通过标签或整数位置分配给列或行：</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">172</span>]: data.loc[:, <span class="st">"one"</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">173</span>]: data</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">173</span>]: </span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>          one  two  three  four</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>Ohio        <span class="dv">1</span>    <span class="dv">0</span>      <span class="dv">0</span>     <span class="dv">0</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>Colorado    <span class="dv">1</span>    <span class="dv">5</span>      <span class="dv">6</span>     <span class="dv">7</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>Utah        <span class="dv">1</span>    <span class="dv">9</span>     <span class="dv">10</span>    <span class="dv">11</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>New York    <span class="dv">1</span>   <span class="dv">13</span>     <span class="dv">14</span>    <span class="dv">15</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">174</span>]: data.iloc[<span class="dv">2</span>] <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">175</span>]: data</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">175</span>]: </span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>          one  two  three  four</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>Ohio        <span class="dv">1</span>    <span class="dv">0</span>      <span class="dv">0</span>     <span class="dv">0</span></span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>Colorado    <span class="dv">1</span>    <span class="dv">5</span>      <span class="dv">6</span>     <span class="dv">7</span></span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>Utah        <span class="dv">5</span>    <span class="dv">5</span>      <span class="dv">5</span>     <span class="dv">5</span></span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>New York    <span class="dv">1</span>   <span class="dv">13</span>     <span class="dv">14</span>    <span class="dv">15</span></span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">176</span>]: data.loc[data[<span class="st">"four"</span>] <span class="op">&gt;</span> <span class="dv">5</span>] <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">177</span>]: data</span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">177</span>]: </span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a>          one  two  three  four</span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a>Ohio        <span class="dv">1</span>    <span class="dv">0</span>      <span class="dv">0</span>     <span class="dv">0</span></span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a>Colorado    <span class="dv">3</span>    <span class="dv">3</span>      <span class="dv">3</span>     <span class="dv">3</span></span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a>Utah        <span class="dv">5</span>    <span class="dv">5</span>      <span class="dv">5</span>     <span class="dv">5</span></span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a>New York    <span class="dv">3</span>    <span class="dv">3</span>      <span class="dv">3</span>     <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>对于新的 pandas 用户来说，一个常见的问题是在分配时链接选择，如下所示：</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">177</span>]: data.loc[data.three <span class="op">==</span> <span class="dv">5</span>][<span class="st">"three"</span>] <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>ipython<span class="op">-</span><span class="bu">input</span><span class="op">-</span><span class="dv">11</span><span class="op">-</span><span class="dv">0</span><span class="er">ed1cf2155d5</span><span class="op">&gt;</span>:<span class="dv">1</span>: SettingWithCopyWarning:</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>A value <span class="kw">is</span> trying to be <span class="bu">set</span> on a copy of a <span class="bu">slice</span> <span class="im">from</span> a DataFrame.</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>Try using .loc[row_indexer,col_indexer] <span class="op">=</span> value instead</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>根据数据内容，这可能会打印一个特殊的 <code>SettingWithCopyWarning</code>，它警告您正在尝试修改临时值（<code>data.loc[data. Three == 5]</code>的非空结果）而不是原始 DataFrame 数据，这可能就是你想要的。这里，<code>data</code> 未修改：</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">179</span>]: data</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">179</span>]: </span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>          one  two  three  four</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>Ohio        <span class="dv">1</span>    <span class="dv">0</span>      <span class="dv">0</span>     <span class="dv">0</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>Colorado    <span class="dv">3</span>    <span class="dv">3</span>      <span class="dv">3</span>     <span class="dv">3</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>Utah        <span class="dv">5</span>    <span class="dv">5</span>      <span class="dv">5</span>     <span class="dv">5</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>New York    <span class="dv">3</span>    <span class="dv">3</span>      <span class="dv">3</span>     <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>在这些情况下，修复方法是重写链式赋值以使用单个 <code>loc</code> 操作：</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">180</span>]: data.loc[data.three <span class="op">==</span> <span class="dv">5</span>, <span class="st">"three"</span>] <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">181</span>]: data</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">181</span>]: </span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>          one  two  three  four</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>Ohio        <span class="dv">1</span>    <span class="dv">0</span>      <span class="dv">0</span>     <span class="dv">0</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>Colorado    <span class="dv">3</span>    <span class="dv">3</span>      <span class="dv">3</span>     <span class="dv">3</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>Utah        <span class="dv">5</span>    <span class="dv">5</span>      <span class="dv">6</span>     <span class="dv">5</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>New York    <span class="dv">3</span>    <span class="dv">3</span>      <span class="dv">3</span>     <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>一个好的经验法则是在进行分配时避免链式索引。在其他情况下，pandas 会生成与链式索引有关的 <code>SettingWithCopyWarning</code>。我建议您参考在线 pandas 文档中的这个主题。</p>
</section>
<section id="arithmetic-and-data-alignment" class="level3" data-number="5.2.4">
<h3 data-number="5.2.4" class="anchored" data-anchor-id="arithmetic-and-data-alignment"><span class="header-section-number">5.2.4</span> Arithmetic and Data Alignment</h3>
<p>pandas 可以使处理具有不同索引的对象变得更加简单。例如，当您添加对象时，如果任何索引对不相同，则结果中的相应索引将是索引对的并集。让我们看一个例子：</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">182</span>]: s1 <span class="op">=</span> pd.Series([<span class="fl">7.3</span>, <span class="op">-</span><span class="fl">2.5</span>, <span class="fl">3.4</span>, <span class="fl">1.5</span>], index<span class="op">=</span>[<span class="st">"a"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span>])</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">183</span>]: s2 <span class="op">=</span> pd.Series([<span class="op">-</span><span class="fl">2.1</span>, <span class="fl">3.6</span>, <span class="op">-</span><span class="fl">1.5</span>, <span class="dv">4</span>, <span class="fl">3.1</span>],</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>   .....:                index<span class="op">=</span>[<span class="st">"a"</span>, <span class="st">"c"</span>, <span class="st">"e"</span>, <span class="st">"f"</span>, <span class="st">"g"</span>])</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">184</span>]: s1</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">184</span>]: </span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>a    <span class="fl">7.3</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>c   <span class="op">-</span><span class="fl">2.5</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>d    <span class="fl">3.4</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>e    <span class="fl">1.5</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>dtype: float64</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">185</span>]: s2</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">185</span>]: </span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>a   <span class="op">-</span><span class="fl">2.1</span></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>c    <span class="fl">3.6</span></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>e   <span class="op">-</span><span class="fl">1.5</span></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>f    <span class="fl">4.0</span></span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>g    <span class="fl">3.1</span></span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>相加：</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">186</span>]: s1 <span class="op">+</span> s2</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">186</span>]: </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>a    <span class="fl">5.2</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>c    <span class="fl">1.1</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>d    NaN</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>e    <span class="fl">0.0</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>f    NaN</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>g    NaN</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>内部数据对齐在不重叠的标签位置引入了缺失值。缺失值将在进一步的算术计算中传播。</p>
<p>对于 DataFrame，对齐是在行和列上执行的：</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">187</span>]: df1 <span class="op">=</span> pd.DataFrame(np.arange(<span class="fl">9.</span>).reshape((<span class="dv">3</span>, <span class="dv">3</span>)), columns<span class="op">=</span><span class="bu">list</span>(<span class="st">"bcd"</span>),</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>   .....:                    index<span class="op">=</span>[<span class="st">"Ohio"</span>, <span class="st">"Texas"</span>, <span class="st">"Colorado"</span>])</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">188</span>]: df2 <span class="op">=</span> pd.DataFrame(np.arange(<span class="fl">12.</span>).reshape((<span class="dv">4</span>, <span class="dv">3</span>)), columns<span class="op">=</span><span class="bu">list</span>(<span class="st">"bde"</span>),</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>   .....:                    index<span class="op">=</span>[<span class="st">"Utah"</span>, <span class="st">"Ohio"</span>, <span class="st">"Texas"</span>, <span class="st">"Oregon"</span>])</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">189</span>]: df1</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">189</span>]: </span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>            b    c    d</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>Ohio      <span class="fl">0.0</span>  <span class="fl">1.0</span>  <span class="fl">2.0</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>Texas     <span class="fl">3.0</span>  <span class="fl">4.0</span>  <span class="fl">5.0</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>Colorado  <span class="fl">6.0</span>  <span class="fl">7.0</span>  <span class="fl">8.0</span></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">190</span>]: df2</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">190</span>]: </span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>          b     d     e</span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>Utah    <span class="fl">0.0</span>   <span class="fl">1.0</span>   <span class="fl">2.0</span></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>Ohio    <span class="fl">3.0</span>   <span class="fl">4.0</span>   <span class="fl">5.0</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>Texas   <span class="fl">6.0</span>   <span class="fl">7.0</span>   <span class="fl">8.0</span></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>Oregon  <span class="fl">9.0</span>  <span class="fl">10.0</span>  <span class="fl">11.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>添加这些会返回一个带有索引和列的 DataFrame，这些索引和列是每个 DataFrame 中的索引和列的并集：</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">191</span>]: df1 <span class="op">+</span> df2</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">191</span>]: </span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>            b   c     d   e</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>Colorado  NaN NaN   NaN NaN</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>Ohio      <span class="fl">3.0</span> NaN   <span class="fl">6.0</span> NaN</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>Oregon    NaN NaN   NaN NaN</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>Texas     <span class="fl">9.0</span> NaN  <span class="fl">12.0</span> NaN</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>Utah      NaN NaN   NaN NaN</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>由于在两个 DataFrame 对象中均未找到 <code>"c"</code> 和 <code>"e"</code> 列，因此它们在结果中显示为缺失。这同样适用于带有两个对象不常见的标签的行。</p>
<p>如果添加没有共同列或行标签的 DataFrame 对象，结果将包含所有空值：</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">192</span>]: df1 <span class="op">=</span> pd.DataFrame({<span class="st">"A"</span>: [<span class="dv">1</span>, <span class="dv">2</span>]})</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">193</span>]: df2 <span class="op">=</span> pd.DataFrame({<span class="st">"B"</span>: [<span class="dv">3</span>, <span class="dv">4</span>]})</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">194</span>]: df1</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">194</span>]: </span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>   A</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="dv">1</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="dv">2</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">195</span>]: df2</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">195</span>]: </span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>   B</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="dv">3</span></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="dv">4</span></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">196</span>]: df1 <span class="op">+</span> df2</span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">196</span>]: </span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>    A   B</span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span> NaN NaN</span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> NaN NaN</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Arithmetic methods with fill values</strong></p>
<p>在不同索引对象之间的算术运算中，当在一个对象中找到轴标签但在另一个对象中未找到时，您可能需要填充特殊值，例如 0。下面是一个示例，我们通过将 <code>np.nan</code> 分配给它来将特定值设置为 NA (null)：</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">197</span>]: df1 <span class="op">=</span> pd.DataFrame(np.arange(<span class="fl">12.</span>).reshape((<span class="dv">3</span>, <span class="dv">4</span>)),</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>   .....:                    columns<span class="op">=</span><span class="bu">list</span>(<span class="st">"abcd"</span>))</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">198</span>]: df2 <span class="op">=</span> pd.DataFrame(np.arange(<span class="fl">20.</span>).reshape((<span class="dv">4</span>, <span class="dv">5</span>)),</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>   .....:                    columns<span class="op">=</span><span class="bu">list</span>(<span class="st">"abcde"</span>))</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">199</span>]: df2.loc[<span class="dv">1</span>, <span class="st">"b"</span>] <span class="op">=</span> np.nan</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">200</span>]: df1</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">200</span>]: </span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>     a    b     c     d</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="fl">0.0</span>  <span class="fl">1.0</span>   <span class="fl">2.0</span>   <span class="fl">3.0</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="fl">4.0</span>  <span class="fl">5.0</span>   <span class="fl">6.0</span>   <span class="fl">7.0</span></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="fl">8.0</span>  <span class="fl">9.0</span>  <span class="fl">10.0</span>  <span class="fl">11.0</span></span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">201</span>]: df2</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">201</span>]: </span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a>      a     b     c     d     e</span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   <span class="fl">0.0</span>   <span class="fl">1.0</span>   <span class="fl">2.0</span>   <span class="fl">3.0</span>   <span class="fl">4.0</span></span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   <span class="fl">5.0</span>   NaN   <span class="fl">7.0</span>   <span class="fl">8.0</span>   <span class="fl">9.0</span></span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="fl">10.0</span>  <span class="fl">11.0</span>  <span class="fl">12.0</span>  <span class="fl">13.0</span>  <span class="fl">14.0</span></span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="fl">15.0</span>  <span class="fl">16.0</span>  <span class="fl">17.0</span>  <span class="fl">18.0</span>  <span class="fl">19.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>相加导致不重叠位置的缺失值：</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">202</span>]: df1 <span class="op">+</span> df2</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">202</span>]: </span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>      a     b     c     d   e</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   <span class="fl">0.0</span>   <span class="fl">2.0</span>   <span class="fl">4.0</span>   <span class="fl">6.0</span> NaN</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   <span class="fl">9.0</span>   NaN  <span class="fl">13.0</span>  <span class="fl">15.0</span> NaN</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="fl">18.0</span>  <span class="fl">20.0</span>  <span class="fl">22.0</span>  <span class="fl">24.0</span> NaN</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>   NaN   NaN   NaN   NaN NaN</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>使用 <code>df1</code> 上的 <code>add</code> 方法，我将 <code>df2</code> 和一个参数传递给 <code>fill_value</code>，这将用传递的值替换操作中的任何缺失值：</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">203</span>]: df1.add(df2, fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">203</span>]: </span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>      a     b     c     d     e</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   <span class="fl">0.0</span>   <span class="fl">2.0</span>   <span class="fl">4.0</span>   <span class="fl">6.0</span>   <span class="fl">4.0</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   <span class="fl">9.0</span>   <span class="fl">5.0</span>  <span class="fl">13.0</span>  <span class="fl">15.0</span>   <span class="fl">9.0</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="fl">18.0</span>  <span class="fl">20.0</span>  <span class="fl">22.0</span>  <span class="fl">24.0</span>  <span class="fl">14.0</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="fl">15.0</span>  <span class="fl">16.0</span>  <span class="fl">17.0</span>  <span class="fl">18.0</span>  <span class="fl">19.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>请参阅 <a href="https://wesmckinney.com/book/pandas-basics#tbl-table_flex_arith">Table 5.5</a>，了解用于算术的 Series 和 DataFrame 方法的列表。每个都有一个对应的，以字母 <code>r</code> 开头，其参数相反。所以这两个语句是等价的：</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">204</span>]: <span class="dv">1</span> <span class="op">/</span> df1</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">204</span>]: </span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>       a         b         c         d</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    inf  <span class="fl">1.000000</span>  <span class="fl">0.500000</span>  <span class="fl">0.333333</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="fl">0.250</span>  <span class="fl">0.200000</span>  <span class="fl">0.166667</span>  <span class="fl">0.142857</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="fl">0.125</span>  <span class="fl">0.111111</span>  <span class="fl">0.100000</span>  <span class="fl">0.090909</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">205</span>]: df1.rdiv(<span class="dv">1</span>)</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">205</span>]: </span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>       a         b         c         d</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    inf  <span class="fl">1.000000</span>  <span class="fl">0.500000</span>  <span class="fl">0.333333</span></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="fl">0.250</span>  <span class="fl">0.200000</span>  <span class="fl">0.166667</span>  <span class="fl">0.142857</span></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="fl">0.125</span>  <span class="fl">0.111111</span>  <span class="fl">0.100000</span>  <span class="fl">0.090909</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>相关地，在重新索引 Series 或 DataFrame 时，您还可以指定不同的填充值：</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">206</span>]: df1.reindex(columns<span class="op">=</span>df2.columns, fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">206</span>]: </span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>     a    b     c     d  e</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="fl">0.0</span>  <span class="fl">1.0</span>   <span class="fl">2.0</span>   <span class="fl">3.0</span>  <span class="dv">0</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="fl">4.0</span>  <span class="fl">5.0</span>   <span class="fl">6.0</span>   <span class="fl">7.0</span>  <span class="dv">0</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="fl">8.0</span>  <span class="fl">9.0</span>  <span class="fl">10.0</span>  <span class="fl">11.0</span>  <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<caption>Table 5.5: Flexible arithmetic methods</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Method</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>add, radd</code></td>
<td style="text-align: left;">Methods for addition (+)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>sub, rsub</code></td>
<td style="text-align: left;">Methods for subtraction (-)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>div, rdiv</code></td>
<td style="text-align: left;">Methods for division (/)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>floordiv, rfloordiv</code></td>
<td style="text-align: left;">Methods for floor division (//)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>mul, rmul</code></td>
<td style="text-align: left;">Methods for multiplication (*)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>pow, rpow</code></td>
<td style="text-align: left;">Methods for exponentiation (**)</td>
</tr>
</tbody>
</table>
<p><strong>Operations between DataFrame and Series</strong></p>
<p>与不同维度的 NumPy 数组一样，DataFrame 和 Series 之间的算术也被定义。首先，作为一个激励示例，考虑二维数组与其行之一之间的差异：</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">207</span>]: arr <span class="op">=</span> np.arange(<span class="fl">12.</span>).reshape((<span class="dv">3</span>, <span class="dv">4</span>))</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">208</span>]: arr</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">208</span>]: </span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>array([[ <span class="fl">0.</span>,  <span class="fl">1.</span>,  <span class="fl">2.</span>,  <span class="fl">3.</span>],</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>       [ <span class="fl">4.</span>,  <span class="fl">5.</span>,  <span class="fl">6.</span>,  <span class="fl">7.</span>],</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>       [ <span class="fl">8.</span>,  <span class="fl">9.</span>, <span class="fl">10.</span>, <span class="fl">11.</span>]])</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">209</span>]: arr[<span class="dv">0</span>]</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">209</span>]: array([<span class="fl">0.</span>, <span class="fl">1.</span>, <span class="fl">2.</span>, <span class="fl">3.</span>])</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">210</span>]: arr <span class="op">-</span> arr[<span class="dv">0</span>]</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">210</span>]: </span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>array([[<span class="fl">0.</span>, <span class="fl">0.</span>, <span class="fl">0.</span>, <span class="fl">0.</span>],</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>       [<span class="fl">4.</span>, <span class="fl">4.</span>, <span class="fl">4.</span>, <span class="fl">4.</span>],</span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>       [<span class="fl">8.</span>, <span class="fl">8.</span>, <span class="fl">8.</span>, <span class="fl">8.</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>当我们从 <code>arr</code> 中减去 <code>arr[0]</code> 时，每行执行一次减法。这称为<em>广播(broadcasting)</em>，并在 <a href="https://wesmckinney.com/book/advanced-numpy">Appendix A: Advanced NumPy</a> 中更详细地解释了它与通用 NumPy 数组的关系。DataFrame 和 Series 之间的操作类似：</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">211</span>]: frame <span class="op">=</span> pd.DataFrame(np.arange(<span class="fl">12.</span>).reshape((<span class="dv">4</span>, <span class="dv">3</span>)),</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>   .....:                      columns<span class="op">=</span><span class="bu">list</span>(<span class="st">"bde"</span>),</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>   .....:                      index<span class="op">=</span>[<span class="st">"Utah"</span>, <span class="st">"Ohio"</span>, <span class="st">"Texas"</span>, <span class="st">"Oregon"</span>])</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">212</span>]: series <span class="op">=</span> frame.iloc[<span class="dv">0</span>]</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">213</span>]: frame</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">213</span>]: </span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>          b     d     e</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>Utah    <span class="fl">0.0</span>   <span class="fl">1.0</span>   <span class="fl">2.0</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>Ohio    <span class="fl">3.0</span>   <span class="fl">4.0</span>   <span class="fl">5.0</span></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>Texas   <span class="fl">6.0</span>   <span class="fl">7.0</span>   <span class="fl">8.0</span></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>Oregon  <span class="fl">9.0</span>  <span class="fl">10.0</span>  <span class="fl">11.0</span></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">214</span>]: series</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">214</span>]: </span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>b    <span class="fl">0.0</span></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>d    <span class="fl">1.0</span></span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>e    <span class="fl">2.0</span></span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>Name: Utah, dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>默认情况下，DataFrame 和 Series 之间的算术与 DataFrame 列上 Series 的索引相匹配，并向下广播行：</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">215</span>]: frame <span class="op">-</span> series</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">215</span>]: </span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>          b    d    e</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>Utah    <span class="fl">0.0</span>  <span class="fl">0.0</span>  <span class="fl">0.0</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>Ohio    <span class="fl">3.0</span>  <span class="fl">3.0</span>  <span class="fl">3.0</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>Texas   <span class="fl">6.0</span>  <span class="fl">6.0</span>  <span class="fl">6.0</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>Oregon  <span class="fl">9.0</span>  <span class="fl">9.0</span>  <span class="fl">9.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>如果在 DataFrame 的列或 Series 的索引中都找不到索引值，则对象将被重新索引以形成并集：</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">216</span>]: series2 <span class="op">=</span> pd.Series(np.arange(<span class="dv">3</span>), index<span class="op">=</span>[<span class="st">"b"</span>, <span class="st">"e"</span>, <span class="st">"f"</span>])</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">217</span>]: series2</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">217</span>]: </span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">0</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>e    <span class="dv">1</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>f    <span class="dv">2</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>dtype: int64</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">218</span>]: frame <span class="op">+</span> series2</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">218</span>]: </span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>          b   d     e   f</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>Utah    <span class="fl">0.0</span> NaN   <span class="fl">3.0</span> NaN</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>Ohio    <span class="fl">3.0</span> NaN   <span class="fl">6.0</span> NaN</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>Texas   <span class="fl">6.0</span> NaN   <span class="fl">9.0</span> NaN</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>Oregon  <span class="fl">9.0</span> NaN  <span class="fl">12.0</span> NaN</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>如果您想在列上进行广播，在行上进行匹配，则必须使用其中一种算术方法并指定在索引上进行匹配。例如：</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">219</span>]: series3 <span class="op">=</span> frame[<span class="st">"d"</span>]</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">220</span>]: frame</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">220</span>]: </span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>          b     d     e</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>Utah    <span class="fl">0.0</span>   <span class="fl">1.0</span>   <span class="fl">2.0</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>Ohio    <span class="fl">3.0</span>   <span class="fl">4.0</span>   <span class="fl">5.0</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>Texas   <span class="fl">6.0</span>   <span class="fl">7.0</span>   <span class="fl">8.0</span></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>Oregon  <span class="fl">9.0</span>  <span class="fl">10.0</span>  <span class="fl">11.0</span></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">221</span>]: series3</span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">221</span>]: </span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>Utah       <span class="fl">1.0</span></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>Ohio       <span class="fl">4.0</span></span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>Texas      <span class="fl">7.0</span></span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>Oregon    <span class="fl">10.0</span></span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>Name: d, dtype: float64</span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">222</span>]: frame.sub(series3, axis<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">222</span>]: </span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a>          b    d    e</span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a>Utah   <span class="op">-</span><span class="fl">1.0</span>  <span class="fl">0.0</span>  <span class="fl">1.0</span></span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a>Ohio   <span class="op">-</span><span class="fl">1.0</span>  <span class="fl">0.0</span>  <span class="fl">1.0</span></span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a>Texas  <span class="op">-</span><span class="fl">1.0</span>  <span class="fl">0.0</span>  <span class="fl">1.0</span></span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a>Oregon <span class="op">-</span><span class="fl">1.0</span>  <span class="fl">0.0</span>  <span class="fl">1.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>您传递的轴是要匹配的轴。在本例中，我们的意思是匹配 DataFrame 的行索引 (<code>axis="index"</code>) 并跨列广播。</p>
</section>
<section id="function-application-and-mapping" class="level3" data-number="5.2.5">
<h3 data-number="5.2.5" class="anchored" data-anchor-id="function-application-and-mapping"><span class="header-section-number">5.2.5</span> Function Application and Mapping</h3>
<p>NumPy ufuncs（逐元素数组方法）也适用于 pandas 对象：</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">223</span>]: frame <span class="op">=</span> pd.DataFrame(np.random.standard_normal((<span class="dv">4</span>, <span class="dv">3</span>)),</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>   .....:                      columns<span class="op">=</span><span class="bu">list</span>(<span class="st">"bde"</span>),</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>   .....:                      index<span class="op">=</span>[<span class="st">"Utah"</span>, <span class="st">"Ohio"</span>, <span class="st">"Texas"</span>, <span class="st">"Oregon"</span>])</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">224</span>]: frame</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">224</span>]: </span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>               b         d         e</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>Utah   <span class="op">-</span><span class="fl">0.204708</span>  <span class="fl">0.478943</span> <span class="op">-</span><span class="fl">0.519439</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>Ohio   <span class="op">-</span><span class="fl">0.555730</span>  <span class="fl">1.965781</span>  <span class="fl">1.393406</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>Texas   <span class="fl">0.092908</span>  <span class="fl">0.281746</span>  <span class="fl">0.769023</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>Oregon  <span class="fl">1.246435</span>  <span class="fl">1.007189</span> <span class="op">-</span><span class="fl">1.296221</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">225</span>]: np.<span class="bu">abs</span>(frame)</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">225</span>]: </span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>               b         d         e</span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>Utah    <span class="fl">0.204708</span>  <span class="fl">0.478943</span>  <span class="fl">0.519439</span></span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>Ohio    <span class="fl">0.555730</span>  <span class="fl">1.965781</span>  <span class="fl">1.393406</span></span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>Texas   <span class="fl">0.092908</span>  <span class="fl">0.281746</span>  <span class="fl">0.769023</span></span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>Oregon  <span class="fl">1.246435</span>  <span class="fl">1.007189</span>  <span class="fl">1.296221</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>另一种常见的操作是将一维数组上的函数应用于每一列或行。DataFrame 的 <code>apply</code> 方法正是这样做的：</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">226</span>]: <span class="kw">def</span> f1(x):</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>   .....:     <span class="cf">return</span> x.<span class="bu">max</span>() <span class="op">-</span> x.<span class="bu">min</span>()</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">227</span>]: frame.<span class="bu">apply</span>(f1)</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">227</span>]: </span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>b    <span class="fl">1.802165</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>d    <span class="fl">1.684034</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>e    <span class="fl">2.689627</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>这里，函数 <code>f</code> 计算 Series 的最大值和最小值之间的差，在 <code>frame</code> 中的每一列上调用一次。结果是一个以 <code>frame</code> 列作为索引的系列。</p>
<p>如果您传递 <code>axis="columns"</code> 给 <code>apply</code>，则该函数将每行调用一次。思考这个问题的一个有用方法是“跨列应用”：</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">228</span>]: frame.<span class="bu">apply</span>(f1, axis<span class="op">=</span><span class="st">"columns"</span>)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">228</span>]: </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>Utah      <span class="fl">0.998382</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>Ohio      <span class="fl">2.521511</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>Texas     <span class="fl">0.676115</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>Oregon    <span class="fl">2.542656</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>许多最常见的数组统计数据（例如 <code>sum</code> 和 <code>Mean</code>）都是 DataFrame 方法，因此没有必要使用 <code>apply</code>。</p>
<p>传递给 <code>apply</code> 的函数不需要返回标量值；它还可以返回具有多个值的 Series：</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">229</span>]: <span class="kw">def</span> f2(x):</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>   .....:     <span class="cf">return</span> pd.Series([x.<span class="bu">min</span>(), x.<span class="bu">max</span>()], index<span class="op">=</span>[<span class="st">"min"</span>, <span class="st">"max"</span>])</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">230</span>]: frame.<span class="bu">apply</span>(f2)</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">230</span>]: </span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>            b         d         e</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="bu">min</span> <span class="op">-</span><span class="fl">0.555730</span>  <span class="fl">0.281746</span> <span class="op">-</span><span class="fl">1.296221</span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a><span class="bu">max</span>  <span class="fl">1.246435</span>  <span class="fl">1.965781</span>  <span class="fl">1.393406</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>也可以使用逐元素 Python 函数。假设您想根据 <code>frame</code> 中的每个浮点值计算格式化字符串。您可以使用 <code>applymap</code> 执行此操作：</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">231</span>]: <span class="kw">def</span> my_format(x):</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>   .....:     <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span>x<span class="sc">:.2f}</span><span class="ss">"</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">232</span>]: frame.applymap(my_format)</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">232</span>]: </span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>            b     d      e</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>Utah    <span class="op">-</span><span class="fl">0.20</span>  <span class="fl">0.48</span>  <span class="op">-</span><span class="fl">0.52</span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>Ohio    <span class="op">-</span><span class="fl">0.56</span>  <span class="fl">1.97</span>   <span class="fl">1.39</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>Texas    <span class="fl">0.09</span>  <span class="fl">0.28</span>   <span class="fl">0.77</span></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>Oregon   <span class="fl">1.25</span>  <span class="fl">1.01</span>  <span class="op">-</span><span class="fl">1.30</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>名称 <code>applymap</code> 的原因是 Series 有一个用于应用逐元素函数的 <code>map</code> 方法：</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">233</span>]: frame[<span class="st">"e"</span>].<span class="bu">map</span>(my_format)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">233</span>]: </span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>Utah      <span class="op">-</span><span class="fl">0.52</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>Ohio       <span class="fl">1.39</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>Texas      <span class="fl">0.77</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>Oregon    <span class="op">-</span><span class="fl">1.30</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>Name: e, dtype: <span class="bu">object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="sorting-and-ranking" class="level3" data-number="5.2.6">
<h3 data-number="5.2.6" class="anchored" data-anchor-id="sorting-and-ranking"><span class="header-section-number">5.2.6</span> Sorting and Ranking</h3>
<p>按某种标准对数据集进行排序是另一个重要的内置操作。要按行或列标签按字典顺序排序，请使用 <code>sort_index</code> 方法，该方法返回一个新的排序对象：</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">234</span>]: obj <span class="op">=</span> pd.Series(np.arange(<span class="dv">4</span>), index<span class="op">=</span>[<span class="st">"d"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>])</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">235</span>]: obj</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">235</span>]: </span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>d    <span class="dv">0</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>a    <span class="dv">1</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">2</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>c    <span class="dv">3</span></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>dtype: int64</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">236</span>]: obj.sort_index()</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">236</span>]: </span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>a    <span class="dv">1</span></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">2</span></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a>c    <span class="dv">3</span></span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>d    <span class="dv">0</span></span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>使用 DataFrame，您可以按任一轴上的索引进行排序：</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">237</span>]: frame <span class="op">=</span> pd.DataFrame(np.arange(<span class="dv">8</span>).reshape((<span class="dv">2</span>, <span class="dv">4</span>)),</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>   .....:                      index<span class="op">=</span>[<span class="st">"three"</span>, <span class="st">"one"</span>],</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>   .....:                      columns<span class="op">=</span>[<span class="st">"d"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>])</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">238</span>]: frame</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">238</span>]: </span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>       d  a  b  c</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>three  <span class="dv">0</span>  <span class="dv">1</span>  <span class="dv">2</span>  <span class="dv">3</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>one    <span class="dv">4</span>  <span class="dv">5</span>  <span class="dv">6</span>  <span class="dv">7</span></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">239</span>]: frame.sort_index()</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">239</span>]: </span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>       d  a  b  c</span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>one    <span class="dv">4</span>  <span class="dv">5</span>  <span class="dv">6</span>  <span class="dv">7</span></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>three  <span class="dv">0</span>  <span class="dv">1</span>  <span class="dv">2</span>  <span class="dv">3</span></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">240</span>]: frame.sort_index(axis<span class="op">=</span><span class="st">"columns"</span>)</span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">240</span>]: </span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a>       a  b  c  d</span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a>three  <span class="dv">1</span>  <span class="dv">2</span>  <span class="dv">3</span>  <span class="dv">0</span></span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a>one    <span class="dv">5</span>  <span class="dv">6</span>  <span class="dv">7</span>  <span class="dv">4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>数据默认按升序排序，但也可以按降序排序：</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">241</span>]: frame.sort_index(axis<span class="op">=</span><span class="st">"columns"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">241</span>]: </span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>       d  c  b  a</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>three  <span class="dv">0</span>  <span class="dv">3</span>  <span class="dv">2</span>  <span class="dv">1</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>one    <span class="dv">4</span>  <span class="dv">7</span>  <span class="dv">6</span>  <span class="dv">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>要按值对 Series 进行排序，请使用其 <code>sort_values</code> 方法：</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">242</span>]: obj <span class="op">=</span> pd.Series([<span class="dv">4</span>, <span class="dv">7</span>, <span class="op">-</span><span class="dv">3</span>, <span class="dv">2</span>])</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">243</span>]: obj.sort_values()</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">243</span>]: </span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   <span class="op">-</span><span class="dv">3</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="dv">2</span></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="dv">4</span></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="dv">7</span></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>默认情况下，所有缺失值都会排序到 Series 末尾：</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">244</span>]: obj <span class="op">=</span> pd.Series([<span class="dv">4</span>, np.nan, <span class="dv">7</span>, np.nan, <span class="op">-</span><span class="dv">3</span>, <span class="dv">2</span>])</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">245</span>]: obj.sort_values()</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">245</span>]: </span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   <span class="op">-</span><span class="fl">3.0</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    <span class="fl">2.0</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="fl">4.0</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="fl">7.0</span></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    NaN</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    NaN</span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>可以使用 <code>na_position</code> 选项将缺失值排序到开头：</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">246</span>]: obj.sort_values(na_position<span class="op">=</span><span class="st">"first"</span>)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">246</span>]: </span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    NaN</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    NaN</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   <span class="op">-</span><span class="fl">3.0</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    <span class="fl">2.0</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="fl">4.0</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="fl">7.0</span></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>对 DataFrame 进行排序时，可以使用一列或多列中的数据作为排序键。为此，请将一个或多个列名称传递给 <code>sort_values</code>：</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">247</span>]: frame <span class="op">=</span> pd.DataFrame({<span class="st">"b"</span>: [<span class="dv">4</span>, <span class="dv">7</span>, <span class="op">-</span><span class="dv">3</span>, <span class="dv">2</span>], <span class="st">"a"</span>: [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>]})</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">248</span>]: frame</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">248</span>]: </span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>   b  a</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="dv">4</span>  <span class="dv">0</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="dv">7</span>  <span class="dv">1</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="op">-</span><span class="dv">3</span>  <span class="dv">0</span></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="dv">2</span>  <span class="dv">1</span></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">249</span>]: frame.sort_values(<span class="st">"b"</span>)</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">249</span>]: </span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>   b  a</span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="op">-</span><span class="dv">3</span>  <span class="dv">0</span></span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="dv">2</span>  <span class="dv">1</span></span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="dv">4</span>  <span class="dv">0</span></span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="dv">7</span>  <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>要按多列排序，请传递名称列表：</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">250</span>]: frame.sort_values([<span class="st">"a"</span>, <span class="st">"b"</span>])</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">250</span>]: </span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>   b  a</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="op">-</span><span class="dv">3</span>  <span class="dv">0</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="dv">4</span>  <span class="dv">0</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="dv">2</span>  <span class="dv">1</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="dv">7</span>  <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>排名从最低值开始，从 1 到数组中有效数据点的数量分配排名。Series 和 DataFrame 的 <code>rank</code> 方法是值得关注的地方；默认情况下，<code>rank</code> 通过为每个组分配平均排名来打破平局：</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">251</span>]: obj <span class="op">=</span> pd.Series([<span class="dv">7</span>, <span class="op">-</span><span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">4</span>])</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">252</span>]: obj.rank()</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">252</span>]: </span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="fl">6.5</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="fl">1.0</span></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="fl">6.5</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="fl">4.5</span></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    <span class="fl">3.0</span></span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    <span class="fl">2.0</span></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>    <span class="fl">4.5</span></span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>还可以根据数据中观察到的顺序来分配排名：</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">253</span>]: obj.rank(method<span class="op">=</span><span class="st">"first"</span>)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">253</span>]: </span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="fl">6.0</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="fl">1.0</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="fl">7.0</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="fl">4.0</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    <span class="fl">3.0</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    <span class="fl">2.0</span></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>    <span class="fl">5.0</span></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>此处，条目 0 和 2 没有使用平均排名 6.5，而是将它们设置为 6 和 7，因为数据中标签 0 位于标签 2 之前。</p>
<p>您也可以按降序排列：</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">254</span>]: obj.rank(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">254</span>]: </span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="fl">1.5</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="fl">7.0</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="fl">1.5</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="fl">3.5</span></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    <span class="fl">5.0</span></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    <span class="fl">6.0</span></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>    <span class="fl">3.5</span></span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>请参阅 <a href="https://wesmckinney.com/book/pandas-basics#tbl-table_pandas_rank">Table 5.6</a>，了解可用的打破平局方法的列表。</p>
<p>DataFrame 可以计算行或列的排名：</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">255</span>]: frame <span class="op">=</span> pd.DataFrame({<span class="st">"b"</span>: [<span class="fl">4.3</span>, <span class="dv">7</span>, <span class="op">-</span><span class="dv">3</span>, <span class="dv">2</span>], <span class="st">"a"</span>: [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>],</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>   .....:                       <span class="st">"c"</span>: [<span class="op">-</span><span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="op">-</span><span class="fl">2.5</span>]})</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">256</span>]: frame</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">256</span>]: </span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>     b  a    c</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="fl">4.3</span>  <span class="dv">0</span> <span class="op">-</span><span class="fl">2.0</span></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="fl">7.0</span>  <span class="dv">1</span>  <span class="fl">5.0</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="op">-</span><span class="fl">3.0</span>  <span class="dv">0</span>  <span class="fl">8.0</span></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="fl">2.0</span>  <span class="dv">1</span> <span class="op">-</span><span class="fl">2.5</span></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">257</span>]: frame.rank(axis<span class="op">=</span><span class="st">"columns"</span>)</span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">257</span>]: </span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>     b    a    c</span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="fl">3.0</span>  <span class="fl">2.0</span>  <span class="fl">1.0</span></span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="fl">3.0</span>  <span class="fl">1.0</span>  <span class="fl">2.0</span></span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="fl">1.0</span>  <span class="fl">2.0</span>  <span class="fl">3.0</span></span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="fl">3.0</span>  <span class="fl">2.0</span>  <span class="fl">1.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<caption>Table 5.6: Tie-breaking methods with rank</caption>
<colgroup>
<col style="width: 30%">
<col style="width: 20%">
<col style="width: 23%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th style="text-align: left;">Description</th>
<th style="text-align: right;"></th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>"average"</code></td>
<td style="text-align: left;">默认值：为同等组中的每个条目分配平均排名</td>
<td style="text-align: right;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td><code>"min"</code></td>
<td style="text-align: left;">使用整个组的最低排名</td>
<td style="text-align: right;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td><code>"max"</code></td>
<td style="text-align: left;">使用整个组的最大排名</td>
<td style="text-align: right;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td><code>"first"</code></td>
<td style="text-align: left;">按照值在数据中出现的顺序分配排名</td>
<td style="text-align: right;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td><code>"dense"</code></td>
<td style="text-align: left;">与 <code>method="min"</code> 类似，但组之间的排名总是增加 1，而不是组中相等元素的数量</td>
<td style="text-align: right;"></td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
</section>
<section id="axis-indexes-with-duplicate-labels" class="level3" data-number="5.2.7">
<h3 data-number="5.2.7" class="anchored" data-anchor-id="axis-indexes-with-duplicate-labels"><span class="header-section-number">5.2.7</span> Axis Indexes with Duplicate Labels</h3>
<p>到目前为止，我们看过的几乎所有示例都有唯一的轴标签（索引值）。虽然许多 pandas 函数（如 <code>reindex</code>）要求标签是唯一的，但这不是强制性的。让我们考虑一个具有重复索引的小 Series：</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">258</span>]: obj <span class="op">=</span> pd.Series(np.arange(<span class="dv">5</span>), index<span class="op">=</span>[<span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>])</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">259</span>]: obj</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">259</span>]: </span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>a    <span class="dv">0</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>a    <span class="dv">1</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">2</span></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">3</span></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>c    <span class="dv">4</span></span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>索引的 <code>is_unique</code> 属性可以告诉你它的标签是否唯一：</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">260</span>]: obj.index.is_unique</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">260</span>]: <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>数据选择是与重复项表现不同的主要因素之一。对具有多个条目的标签进行索引会返回一个 Series，而单个条目则返回一个标量值：</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">261</span>]: obj[<span class="st">"a"</span>]</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">261</span>]: </span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>a    <span class="dv">0</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>a    <span class="dv">1</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>dtype: int64</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">262</span>]: obj[<span class="st">"c"</span>]</span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">262</span>]: <span class="dv">4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>这可能会使您的代码更加复杂，因为索引的输出类型可能会根据标签是否重复而有所不同。</p>
<p>相同的逻辑扩展到 DataFrame 中的索引行（或列）：</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">263</span>]: df <span class="op">=</span> pd.DataFrame(np.random.standard_normal((<span class="dv">5</span>, <span class="dv">3</span>)),</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>   .....:                   index<span class="op">=</span>[<span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>])</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">264</span>]: df</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">264</span>]: </span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>          <span class="dv">0</span>         <span class="dv">1</span>         <span class="dv">2</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>a  <span class="fl">0.274992</span>  <span class="fl">0.228913</span>  <span class="fl">1.352917</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>a  <span class="fl">0.886429</span> <span class="op">-</span><span class="fl">2.001637</span> <span class="op">-</span><span class="fl">0.371843</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>b  <span class="fl">1.669025</span> <span class="op">-</span><span class="fl">0.438570</span> <span class="op">-</span><span class="fl">0.539741</span></span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>b  <span class="fl">0.476985</span>  <span class="fl">3.248944</span> <span class="op">-</span><span class="fl">1.021228</span></span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>c <span class="op">-</span><span class="fl">0.577087</span>  <span class="fl">0.124121</span>  <span class="fl">0.302614</span></span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">265</span>]: df.loc[<span class="st">"b"</span>]</span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">265</span>]: </span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a>          <span class="dv">0</span>         <span class="dv">1</span>         <span class="dv">2</span></span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a>b  <span class="fl">1.669025</span> <span class="op">-</span><span class="fl">0.438570</span> <span class="op">-</span><span class="fl">0.539741</span></span>
<span id="cb116-17"><a href="#cb116-17" aria-hidden="true" tabindex="-1"></a>b  <span class="fl">0.476985</span>  <span class="fl">3.248944</span> <span class="op">-</span><span class="fl">1.021228</span></span>
<span id="cb116-18"><a href="#cb116-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-19"><a href="#cb116-19" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">266</span>]: df.loc[<span class="st">"c"</span>]</span>
<span id="cb116-20"><a href="#cb116-20" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">266</span>]: </span>
<span id="cb116-21"><a href="#cb116-21" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   <span class="op">-</span><span class="fl">0.577087</span></span>
<span id="cb116-22"><a href="#cb116-22" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="fl">0.124121</span></span>
<span id="cb116-23"><a href="#cb116-23" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="fl">0.302614</span></span>
<span id="cb116-24"><a href="#cb116-24" aria-hidden="true" tabindex="-1"></a>Name: c, dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="summarizing-and-computing-descriptive-statistics" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="summarizing-and-computing-descriptive-statistics"><span class="header-section-number">5.3</span> Summarizing and Computing Descriptive Statistics</h2>
<p>pandas 对象配备了一套常见的数学和统计方法。其中大多数属于归约或汇总统计的类别，从 Series 中提取单个值（如总和或平均值）的方法，或从 DataFrame 的行或列中提取一系列值的方法。与 NumPy 数组上的类似方法相比，它们具有针对丢失数据的内置处理。考虑一个小的 DataFrame：</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">267</span>]: df <span class="op">=</span> pd.DataFrame([[<span class="fl">1.4</span>, np.nan], [<span class="fl">7.1</span>, <span class="op">-</span><span class="fl">4.5</span>],</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>   .....:                    [np.nan, np.nan], [<span class="fl">0.75</span>, <span class="op">-</span><span class="fl">1.3</span>]],</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>   .....:                   index<span class="op">=</span>[<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>],</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>   .....:                   columns<span class="op">=</span>[<span class="st">"one"</span>, <span class="st">"two"</span>])</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">268</span>]: df</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">268</span>]: </span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>    one  two</span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>a  <span class="fl">1.40</span>  NaN</span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>b  <span class="fl">7.10</span> <span class="op">-</span><span class="fl">4.5</span></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a>c   NaN  NaN</span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>d  <span class="fl">0.75</span> <span class="op">-</span><span class="fl">1.3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>调用 DataFrame 的 <code>sum</code> 方法会返回一个包含列总和的 Series：</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">269</span>]: df.<span class="bu">sum</span>()</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">269</span>]: </span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>one    <span class="fl">9.25</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>two   <span class="op">-</span><span class="fl">5.80</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>而是传递 <code>axis="columns"</code> 或 <code>axis=1</code> 跨列求和：</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">270</span>]: df.<span class="bu">sum</span>(axis<span class="op">=</span><span class="st">"columns"</span>)</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">270</span>]: </span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>a    <span class="fl">1.40</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>b    <span class="fl">2.60</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>c    <span class="fl">0.00</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>d   <span class="op">-</span><span class="fl">0.55</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>当整行或整列包含所有 NA 值时，总和为 0，而如果任何值不为 NA，则结果为 NA。可以使用 <code>skipna</code> 选项禁用此功能，在这种情况下，行或列中的任何 NA 值都会命名相应的结果 NA：</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">271</span>]: df.<span class="bu">sum</span>(axis<span class="op">=</span><span class="st">"index"</span>, skipna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">271</span>]: </span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>one   NaN</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>two   NaN</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>dtype: float64</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">272</span>]: df.<span class="bu">sum</span>(axis<span class="op">=</span><span class="st">"columns"</span>, skipna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">272</span>]: </span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>a     NaN</span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>b    <span class="fl">2.60</span></span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a>c     NaN</span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a>d   <span class="op">-</span><span class="fl">0.55</span></span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>一些聚合（例如 <code>mean</code>）需要至少一个非 NA 值才能产生值结果，因此这里我们有：</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">273</span>]: df.mean(axis<span class="op">=</span><span class="st">"columns"</span>)</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">273</span>]: </span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>a    <span class="fl">1.400</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>b    <span class="fl">1.300</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>c      NaN</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>d   <span class="op">-</span><span class="fl">0.275</span></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>请参阅 <a href="https://wesmckinney.com/book/pandas-basics#tbl-table_pandas_reduction">Table 5.7</a>，了解每种缩减方法的常用选项列表。</p>
<table class="table">
<caption>Table 5.7: Options for reduction methods</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Method</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>axis</code></td>
<td style="text-align: left;">轴减少过度；DataFrame 的行的“index”和列的“columns”</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>skipna</code></td>
<td style="text-align: left;">排除缺失值；默认为 <code>True</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>level</code></td>
<td style="text-align: left;">如果轴是分层索引的（MultiIndex），则减少按级别分组</td>
</tr>
</tbody>
</table>
<p>某些方法（例如 <code>idxmin</code> 和 <code>idxmax</code>）返回间接统计信息，例如达到最小值或最大值的索引值：</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">274</span>]: df.idxmax()</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">274</span>]: </span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>one    b</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>two    d</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>其他方法都是累加：</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">275</span>]: df.cumsum()</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">275</span>]: </span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>    one  two</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>a  <span class="fl">1.40</span>  NaN</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>b  <span class="fl">8.50</span> <span class="op">-</span><span class="fl">4.5</span></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>c   NaN  NaN</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>d  <span class="fl">9.25</span> <span class="op">-</span><span class="fl">5.8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>有些方法既不是减法，也不是累加。<code>describe</code> 就是这样一个例子，一次性生成多个汇总统计信息：</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">276</span>]: df.describe()</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">276</span>]: </span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>            one       two</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>count  <span class="fl">3.000000</span>  <span class="fl">2.000000</span></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>mean   <span class="fl">3.083333</span> <span class="op">-</span><span class="fl">2.900000</span></span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>std    <span class="fl">3.493685</span>  <span class="fl">2.262742</span></span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a><span class="bu">min</span>    <span class="fl">0.750000</span> <span class="op">-</span><span class="fl">4.500000</span></span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a><span class="dv">25</span><span class="op">%</span>    <span class="fl">1.075000</span> <span class="op">-</span><span class="fl">3.700000</span></span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a><span class="dv">50</span><span class="op">%</span>    <span class="fl">1.400000</span> <span class="op">-</span><span class="fl">2.900000</span></span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a><span class="dv">75</span><span class="op">%</span>    <span class="fl">4.250000</span> <span class="op">-</span><span class="fl">2.100000</span></span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a><span class="bu">max</span>    <span class="fl">7.100000</span> <span class="op">-</span><span class="fl">1.300000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>对于非数字数据，<code>describe</code> 会生成替代的汇总统计数据：</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">277</span>]: obj <span class="op">=</span> pd.Series([<span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>] <span class="op">*</span> <span class="dv">4</span>)</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">278</span>]: obj.describe()</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">278</span>]: </span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>count     <span class="dv">16</span></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>unique     <span class="dv">3</span></span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>top        a</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>freq       <span class="dv">8</span></span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>有关汇总统计数据和相关方法的完整列表，请参阅 <a href="https://wesmckinney.com/book/pandas-basics#tbl-table_descriptive_stats">Table 5.8</a>。</p>
<table class="table">
<caption>Table 5.8: Descriptive and summary statistics</caption>
<colgroup>
<col style="width: 62%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Method</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>count</code></td>
<td style="text-align: left;">Number of non-NA values</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>describe</code></td>
<td style="text-align: left;">Compute set of summary statistics</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>min, max</code></td>
<td style="text-align: left;">Compute minimum and maximum values</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>argmin, argmax</code></td>
<td style="text-align: left;">Compute index locations (integers) at which minimum or maximum value is obtained, respectively; not available on DataFrame objects</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>idxmin, idxmax</code></td>
<td style="text-align: left;">Compute index labels at which minimum or maximum value is obtained, respectively</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>quantile</code></td>
<td style="text-align: left;">Compute sample quantile ranging from 0 to 1 (default: 0.5)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>sum</code></td>
<td style="text-align: left;">Sum of values</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>mean</code></td>
<td style="text-align: left;">Mean of values</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>median</code></td>
<td style="text-align: left;">Arithmetic median (50% quantile) of values</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>mad</code></td>
<td style="text-align: left;">Mean absolute deviation from mean value</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>prod</code></td>
<td style="text-align: left;">Product of all values</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>var</code></td>
<td style="text-align: left;">Sample variance of values</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>std</code></td>
<td style="text-align: left;">Sample standard deviation of values</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>skew</code></td>
<td style="text-align: left;">Sample skewness (third moment) of values</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>kurt</code></td>
<td style="text-align: left;">Sample kurtosis (fourth moment) of values</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>cumsum</code></td>
<td style="text-align: left;">Cumulative sum of values</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>cummin, cummax</code></td>
<td style="text-align: left;">Cumulative minimum or maximum of values, respectively</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>cumprod</code></td>
<td style="text-align: left;">Cumulative product of values</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>diff</code></td>
<td style="text-align: left;">Compute first arithmetic difference (useful for time series)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>pct_change</code></td>
<td style="text-align: left;">Compute percent changes</td>
</tr>
</tbody>
</table>
<section id="correlation-and-covariance" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="correlation-and-covariance"><span class="header-section-number">5.3.1</span> Correlation and Covariance</h3>
<p>一些汇总统计数据（例如相关性和协方差）是根据参数对计算的。让我们考虑一些最初从 Yahoo! 获得的股票价格和交易量的 DataFrames。财务并以二进制 Python pickle 文件形式提供，您可以在本书随附的数据集中找到：</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">279</span>]: price <span class="op">=</span> pd.read_pickle(<span class="st">"examples/yahoo_price.pkl"</span>)</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">280</span>]: volume <span class="op">=</span> pd.read_pickle(<span class="st">"examples/yahoo_volume.pkl"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>我现在计算价格的百分比变化，这是一种时间序列运算，将在 <a href="https://wesmckinney.com/book/time-series">Ch 11: Time Series</a> 中进一步探讨：</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">281</span>]: returns <span class="op">=</span> price.pct_change()</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">282</span>]: returns.tail()</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">282</span>]: </span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>                AAPL      GOOG       IBM      MSFT</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>Date                                              </span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2016</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">17</span> <span class="op">-</span><span class="fl">0.000680</span>  <span class="fl">0.001837</span>  <span class="fl">0.002072</span> <span class="op">-</span><span class="fl">0.003483</span></span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2016</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">18</span> <span class="op">-</span><span class="fl">0.000681</span>  <span class="fl">0.019616</span> <span class="op">-</span><span class="fl">0.026168</span>  <span class="fl">0.007690</span></span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a><span class="dv">2016</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">19</span> <span class="op">-</span><span class="fl">0.002979</span>  <span class="fl">0.007846</span>  <span class="fl">0.003583</span> <span class="op">-</span><span class="fl">0.002255</span></span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a><span class="dv">2016</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">20</span> <span class="op">-</span><span class="fl">0.000512</span> <span class="op">-</span><span class="fl">0.005652</span>  <span class="fl">0.001719</span> <span class="op">-</span><span class="fl">0.004867</span></span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a><span class="dv">2016</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">21</span> <span class="op">-</span><span class="fl">0.003930</span>  <span class="fl">0.003011</span> <span class="op">-</span><span class="fl">0.012474</span>  <span class="fl">0.042096</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Series 的 <code>corr</code> 方法计算两个 Series 中重叠的、非 NA 的、按索引对齐的值的相关性。相关地，<code>cov</code> 计算协方差：</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">283</span>]: returns[<span class="st">"MSFT"</span>].corr(returns[<span class="st">"IBM"</span>])</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">283</span>]: <span class="fl">0.49976361144151166</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">284</span>]: returns[<span class="st">"MSFT"</span>].cov(returns[<span class="st">"IBM"</span>])</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">284</span>]: <span class="fl">8.870655479703549e-05</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>另一方面，DataFrame 的 <code>corr</code> 和 <code>cov</code> 方法分别返回完整的相关或协方差矩阵作为 DataFrame：</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">285</span>]: returns.corr()</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">285</span>]: </span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>          AAPL      GOOG       IBM      MSFT</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>AAPL  <span class="fl">1.000000</span>  <span class="fl">0.407919</span>  <span class="fl">0.386817</span>  <span class="fl">0.389695</span></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>GOOG  <span class="fl">0.407919</span>  <span class="fl">1.000000</span>  <span class="fl">0.405099</span>  <span class="fl">0.465919</span></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>IBM   <span class="fl">0.386817</span>  <span class="fl">0.405099</span>  <span class="fl">1.000000</span>  <span class="fl">0.499764</span></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>MSFT  <span class="fl">0.389695</span>  <span class="fl">0.465919</span>  <span class="fl">0.499764</span>  <span class="fl">1.000000</span></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">286</span>]: returns.cov()</span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">286</span>]: </span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a>          AAPL      GOOG       IBM      MSFT</span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a>AAPL  <span class="fl">0.000277</span>  <span class="fl">0.000107</span>  <span class="fl">0.000078</span>  <span class="fl">0.000095</span></span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a>GOOG  <span class="fl">0.000107</span>  <span class="fl">0.000251</span>  <span class="fl">0.000078</span>  <span class="fl">0.000108</span></span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a>IBM   <span class="fl">0.000078</span>  <span class="fl">0.000078</span>  <span class="fl">0.000146</span>  <span class="fl">0.000089</span></span>
<span id="cb129-15"><a href="#cb129-15" aria-hidden="true" tabindex="-1"></a>MSFT  <span class="fl">0.000095</span>  <span class="fl">0.000108</span>  <span class="fl">0.000089</span>  <span class="fl">0.000215</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>使用 DataFrame 的 <code>corrwith</code> 方法，您可以计算 DataFrame 的列或行与另一个 Series 或 DataFrame 之间的成对相关性。传递 Series 返回一个 Series，其中包含为每列计算的相关值：</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">287</span>]: returns.corrwith(returns[<span class="st">"IBM"</span>])</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">287</span>]: </span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>AAPL    <span class="fl">0.386817</span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>GOOG    <span class="fl">0.405099</span></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>IBM     <span class="fl">1.000000</span></span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>MSFT    <span class="fl">0.499764</span></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>传递 DataFrame 会计算匹配列名称的相关性。在这里，我计算百分比变化与交易量的相关性：</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">288</span>]: returns.corrwith(volume)</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">288</span>]: </span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>AAPL   <span class="op">-</span><span class="fl">0.075565</span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>GOOG   <span class="op">-</span><span class="fl">0.007067</span></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>IBM    <span class="op">-</span><span class="fl">0.204849</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>MSFT   <span class="op">-</span><span class="fl">0.092950</span></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>传递 <code>axis="columns"</code> 会逐行执行操作。在所有情况下，在计算相关性之前，数据点都会按标签对齐。</p>
</section>
<section id="unique-values-value-counts-and-membership" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="unique-values-value-counts-and-membership"><span class="header-section-number">5.3.2</span> Unique Values, Value Counts, and Membership</h3>
<p>另一类相关方法提取有关一维 Series 中包含的值的信息。为了说明这些，请考虑以下示例：</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">289</span>]: obj <span class="op">=</span> pd.Series([<span class="st">"c"</span>, <span class="st">"a"</span>, <span class="st">"d"</span>, <span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"c"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>第一个函数是 <code>unique</code>，它为您提供 Series 中唯一值的数组：</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">290</span>]: uniques <span class="op">=</span> obj.unique()</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">291</span>]: uniques</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">291</span>]: array([<span class="st">'c'</span>, <span class="st">'a'</span>, <span class="st">'d'</span>, <span class="st">'b'</span>], dtype<span class="op">=</span><span class="bu">object</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>唯一值不一定按它们首次出现的顺序返回，也不是按排序顺序返回，但如果需要，可以在事后对它们进行排序 (<code>uniques.sort()</code>)。相关地，<code>value_counts</code> 计算包含值频率的 Series：</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">292</span>]: obj.value_counts()</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">292</span>]: </span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>c    <span class="dv">3</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>a    <span class="dv">3</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">2</span></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>d    <span class="dv">1</span></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>Name: count, dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>为了方便起见，该 Series 按值降序排列。<code>value_counts</code> 也可用作顶级 pandas 方法，可与 NumPy 数组或其他 Python 序列一起使用：</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">293</span>]: pd.value_counts(obj.to_numpy(), sort<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">293</span>]: </span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>c    <span class="dv">3</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>a    <span class="dv">3</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>d    <span class="dv">1</span></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">2</span></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>Name: count, dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>isin</code> 执行矢量化集成员资格检查，可用于将数据集过滤为 DataFrame 中的 Series 或列中的值的子集：</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">294</span>]: obj</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">294</span>]: </span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    c</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    a</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    d</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    a</span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    a</span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    b</span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>    b</span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>    c</span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>    c</span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">object</span></span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">295</span>]: mask <span class="op">=</span> obj.isin([<span class="st">"b"</span>, <span class="st">"c"</span>])</span>
<span id="cb136-15"><a href="#cb136-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-16"><a href="#cb136-16" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">296</span>]: mask</span>
<span id="cb136-17"><a href="#cb136-17" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">296</span>]: </span>
<span id="cb136-18"><a href="#cb136-18" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     <span class="va">True</span></span>
<span id="cb136-19"><a href="#cb136-19" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="va">False</span></span>
<span id="cb136-20"><a href="#cb136-20" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="va">False</span></span>
<span id="cb136-21"><a href="#cb136-21" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="va">False</span></span>
<span id="cb136-22"><a href="#cb136-22" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    <span class="va">False</span></span>
<span id="cb136-23"><a href="#cb136-23" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>     <span class="va">True</span></span>
<span id="cb136-24"><a href="#cb136-24" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>     <span class="va">True</span></span>
<span id="cb136-25"><a href="#cb136-25" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>     <span class="va">True</span></span>
<span id="cb136-26"><a href="#cb136-26" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>     <span class="va">True</span></span>
<span id="cb136-27"><a href="#cb136-27" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">bool</span></span>
<span id="cb136-28"><a href="#cb136-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-29"><a href="#cb136-29" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">297</span>]: obj[mask]</span>
<span id="cb136-30"><a href="#cb136-30" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">297</span>]: </span>
<span id="cb136-31"><a href="#cb136-31" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    c</span>
<span id="cb136-32"><a href="#cb136-32" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    b</span>
<span id="cb136-33"><a href="#cb136-33" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>    b</span>
<span id="cb136-34"><a href="#cb136-34" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>    c</span>
<span id="cb136-35"><a href="#cb136-35" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>    c</span>
<span id="cb136-36"><a href="#cb136-36" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>与 <code>isin</code> 相关的是 <code>Index.get_indexer</code> 方法，它为您提供一个索引数组，从一个可能非不同值的数组到另一个不同值的数组：</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">298</span>]: to_match <span class="op">=</span> pd.Series([<span class="st">"c"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"a"</span>])</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">299</span>]: unique_vals <span class="op">=</span> pd.Series([<span class="st">"c"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>])</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">300</span>]: indices <span class="op">=</span> pd.Index(unique_vals).get_indexer(to_match)</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">301</span>]: indices</span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">301</span>]: array([<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>有关这些方法的参考，请参阅 <a href="https://wesmckinney.com/book/pandas-basics#tbl-table_binning">Table 5.9</a>。</p>
<table class="table">
<caption>Table 5.9: Unique, value counts, and set membership methods</caption>
<colgroup>
<col style="width: 62%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Method</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>isin</code></td>
<td style="text-align: left;">计算一个布尔数组，指示每个 Series 或 DataFrame 值是否包含在传递的值序列中</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>get_indexer</code></td>
<td style="text-align: left;">将数组中每个值的整数索引计算到另一个不同值的数组中；有助于数据对齐和连接类型操作</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>unique</code></td>
<td style="text-align: left;">计算 Series 中唯一值的数组，按观察到的顺序返回</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>value_counts</code></td>
<td style="text-align: left;">返回一个包含唯一值作为其索引和频率作为其值的 Series，按降序排列计数</td>
</tr>
</tbody>
</table>
<p>在某些情况下，您可能需要计算 DataFrame 中多个相关列的直方图。这是一个例子：</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">302</span>]: data <span class="op">=</span> pd.DataFrame({<span class="st">"Qu1"</span>: [<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">4</span>],</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>   .....:                      <span class="st">"Qu2"</span>: [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>],</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>   .....:                      <span class="st">"Qu3"</span>: [<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">4</span>]})</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">303</span>]: data</span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">303</span>]: </span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>   Qu1  Qu2  Qu3</span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="dv">1</span>    <span class="dv">2</span>    <span class="dv">1</span></span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="dv">3</span>    <span class="dv">3</span>    <span class="dv">5</span></span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="dv">4</span>    <span class="dv">1</span>    <span class="dv">2</span></span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="dv">3</span>    <span class="dv">2</span>    <span class="dv">4</span></span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    <span class="dv">4</span>    <span class="dv">3</span>    <span class="dv">4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>我们可以计算单个列的值计数，如下所示：</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">304</span>]: data[<span class="st">"Qu1"</span>].value_counts().sort_index()</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">304</span>]: </span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>Qu1</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="dv">1</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="dv">2</span></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    <span class="dv">2</span></span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>Name: count, dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>要计算所有列的值，请将 <code>pandas.value_counts</code> 传递给 DataFrame 的 <code>apply</code> 方法：</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">305</span>]: result <span class="op">=</span> data.<span class="bu">apply</span>(pd.value_counts).fillna(<span class="dv">0</span>)</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">306</span>]: result</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">306</span>]: </span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>   Qu1  Qu2  Qu3</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="fl">1.0</span>  <span class="fl">1.0</span>  <span class="fl">1.0</span></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="fl">0.0</span>  <span class="fl">2.0</span>  <span class="fl">1.0</span></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="fl">2.0</span>  <span class="fl">2.0</span>  <span class="fl">0.0</span></span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="fl">2.0</span>  <span class="fl">0.0</span>  <span class="fl">2.0</span></span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  <span class="fl">0.0</span>  <span class="fl">0.0</span>  <span class="fl">1.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>在这里，结果中的行标签是所有列中出现的不同值。这些值是每列中这些值的相应计数。</p>
<p>还有一个 <code>DataFrame.value_counts</code> 方法，但它将 DataFrame 的每一行视为一个元组来计算计数，以确定每个不同行的出现次数：</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">307</span>]: data <span class="op">=</span> pd.DataFrame({<span class="st">"a"</span>: [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>], <span class="st">"b"</span>: [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>]})</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">308</span>]: data</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">308</span>]: </span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>   a  b</span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="dv">1</span>  <span class="dv">0</span></span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="dv">1</span>  <span class="dv">0</span></span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="dv">1</span>  <span class="dv">1</span></span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="dv">2</span>  <span class="dv">0</span></span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="dv">2</span>  <span class="dv">0</span></span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">309</span>]: data.value_counts()</span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">309</span>]: </span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a>a  b</span>
<span id="cb141-15"><a href="#cb141-15" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="dv">0</span>    <span class="dv">2</span></span>
<span id="cb141-16"><a href="#cb141-16" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="dv">0</span>    <span class="dv">2</span></span>
<span id="cb141-17"><a href="#cb141-17" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="dv">1</span>    <span class="dv">1</span></span>
<span id="cb141-18"><a href="#cb141-18" aria-hidden="true" tabindex="-1"></a>Name: count, dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>在这种情况下，结果有一个索引，将不同的行表示为分层索引，我们将在 <a href="https://wesmckinney.com/book/data-wrangling">Ch 8: Data Wrangling: Join, Combine, and Reshape</a> 中更详细地探讨该主题。</p>
</section>
</section>
<section id="conclusion" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">5.4</span> Conclusion</h2>
<p>在下一章中，我们将讨论使用 pandas 读取（或加载）和写入数据集的工具。之后，我们将更深入地研究使用 pandas 的数据清理、整理、分析和可视化工具。</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/ZhengTiger\.github\.io\/pydata-book-zh-cn\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./04.numpy-basics.html" class="pagination-link" aria-label="NumPy Basics: Arrays and Vectorized Computation">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">NumPy Basics: Arrays and Vectorized Computation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ZhengTiger/pydata-book-zh-cn/edit/main/05.pandas-basics.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/ZhengTiger/pydata-book-zh-cn/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>